<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 11.2.0"/>
    <title>x4i.exfor_field API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;cursor:pointer;}.pdoc details > summary:focus{outline:0;}.pdoc > section.module-info details > summary{top:-20px;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../x4i.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;x4i</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="function" href="#chunkifyX4TextField">chunkifyX4TextField</a>
            </li>
            <li>
                    <a class="function" href="#extractX4FieldType">extractX4FieldType</a>
            </li>
            <li>
                    <a class="function" href="#extractX4FieldPointer">extractX4FieldPointer</a>
            </li>
            <li>
                    <a class="class" href="#X4SubField">X4SubField</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#X4PlainField">X4PlainField</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#X4PlainField.total_len">total_len</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#X4ReactionField">X4ReactionField</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#X4ReactionField.getMeasurementType">getMeasurementType</a>
                        </li>
                        <li>
                                <a class="function" href="#X4ReactionField.getEquation">getEquation</a>
                        </li>
                        <li>
                                <a class="function" href="#X4ReactionField.getX4ReactionList">getX4ReactionList</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#X4MonitorField">X4MonitorField</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#X4ReferenceField">X4ReferenceField</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#X4ReferenceField.flatten">flatten</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#X4TitleField">X4TitleField</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#X4AuthorField">X4AuthorField</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#X4InstituteField">X4InstituteField</a>
                            <ul class="memberlist">
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../x4i.html">x4i</a><wbr>.exfor_field    </h1>

                
                        <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="L-0"><a href="#L-0"><span class="linenos">  0</span></a><span class="c1"># Copyright (c) 2011, Lawrence Livermore National Security, LLC. Produced at</span>
</span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># the Lawrence Livermore National Laboratory. Written by David A. Brown</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1"># &lt;brown170@llnl.gov&gt;.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="c1">#</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="c1"># LLNL-CODE-484151 All rights reserved.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="c1">#</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="c1"># This file is part of EXFOR Interface (x4i)</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="c1">#</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="c1"># Please also read the LICENSE.txt file included in this distribution, under</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="c1"># &quot;Our Notice and GNU General Public License&quot;.</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="c1">#</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="c1"># This program is free software; you can redistribute it and/or modify it</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="c1"># under the terms of the GNU General Public License (as published by the</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="c1"># Free Software Foundation) version 2, dated June 1991.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="c1">#</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="c1"># This program is distributed in the hope that it will be useful, but WITHOUT</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="c1"># ANY WARRANTY; without even the IMPLIED WARRANTY OF</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="c1"># terms and conditions of the GNU General Public License for more details.</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="c1">#</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="c1"># You should have received a copy of the GNU General Public License</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="c1"># along with this program; if not, write to the Free Software Foundation,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="c1"># Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="c1">################################################################################</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="c1">#</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="c1"># Changes since LLNL release (x4i-1.0):</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="c1">#</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="c1">#   0.     improved author parsing</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="c1">#          improved reaction parsing error reporting (David Brown &lt;dbrown@bnl.gov&gt;, 2019-08-16T17:26:18)</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="c1">#   1.     make sure output is sorted by pointer in ALL cases</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="c1">#          adjust unit test accordingly (David Brown &lt;dbrown@bnl.gov&gt;, 2018-12-05T20:03:27)</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="c1">#   2.     dealing with map() and open() issues (David Brown &lt;dbrown@bnl.gov&gt;, 2018-12-05T19:49:24)</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="c1">#   3.     get rid of more bad-behaving map() functions (David Brown &lt;dbrown@bnl.gov&gt;, 2018-12-05T17:55:16)</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="c1">#   4.     grammar is spelled &quot;grammar&quot; not &quot;grammer&quot; (David Brown &lt;dbrown@bnl.gov&gt;, 2018-12-05T16:41:09)</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="c1">#   5.     pyparsing import fix (David Brown &lt;dbrown@bnl.gov&gt;, 2018-12-04T22:15:06)</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="c1">#   6.     py3 porting issue: {}.keys() returns view, not list (David Brown &lt;dbrown@bnl.gov&gt;, 2018-12-04T22:02:30)</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="c1">#   7.     fixing imports (David Brown &lt;dbrown@bnl.gov&gt;, 2018-12-04T21:09:44)</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="c1">#   8.     Python3.X compatibility &amp; PEP-8 compliance (David Brown &lt;dbrown@bnl.gov&gt;, 2018-12-04T17:44:23)</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="c1">#   9.     fix reference parsing</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="c1">#          fix reaction parsing when have isomer projectile, isomer math at same time (David Brown &lt;dbrown@bnl.gov&gt;, 2013-06-26T22:32:42)</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="c1">#   10.    fix bug with reaction list when handling isomer math</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="c1">#          add unit tests</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="c1">#          lots of unit tests (David Brown &lt;dbrown@bnl.gov&gt;, 2013-06-26T17:51:53)</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="c1">#   11.     handle pathological author list (David Brown &lt;dbrown@bnl.gov&gt;, 2013-06-26T15:40:35)</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="c1">#   12.     rip out debugging stuff (David Brown &lt;dbrown@bnl.gov&gt;, 2013-06-20T15:14:44)</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="c1">#   13.     fix field parsing in presence of blank lines that maybe have to be preserved (David Brown &lt;dbrown@bnl.gov&gt;, 2013-06-19T19:28:24)</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="c1">#   14.     parsing even really complicated monitors now work and all are printed when you print a data set (David Brown &lt;dbrown@bnl.gov&gt;, 2013-06-18T14:40:59)</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="c1">#   15.     trying to get monitors working (David Brown &lt;dbrown@bnl.gov&gt;, 2013-06-18T13:26:10)</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="c1">#   16.     start work debugging monitor field (David Brown &lt;dbrown@bnl.gov&gt;, 2013-06-18T12:01:04)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="c1">#   17.     correct parsing of monitors to properly distinguish between multiple monitors and those with associated column headings in DATA section (David Brown &lt;dbrown@bnl.gov&gt;, 2013-01-11T18:58:32)</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="c1">#   18.     monitors now parsed and packed into a data structure (David Brown &lt;dbrown@bnl.gov&gt;, 2013-01-10T15:55:39)</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="c1">#   19.     add X4MonitorField &amp; add blank line between member functions for clarity (David Brown &lt;dbrown@bnl.gov&gt;, 2013-01-08T19:31:15)</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="c1">#   20.     add a reaction list function that we can use to substitute in the getEquation() function (David Brown &lt;dbrown@bnl.gov&gt;, 2012-09-11T12:37:21)</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="c1">#   21.     make getEquantion() return schematic or actual reactions (David Brown &lt;dbrown@bnl.gov&gt;, 2012-09-11T02:53:59)</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="c1">#   22.     getEquation() when the equation actually is easy to get (David Brown &lt;dbrown@bnl.gov&gt;, 2012-09-11T02:46:53)</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="c1">#   23.     add widget to extract the reaction equation (esp. useful for coupled reactions)</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="c1">#           use widget to collect improved statistics on the coupled data -- in preparation for making the COMMARA cross material covariance (David Brown &lt;dbrown@bnl.gov&gt;, 2012-08-01T03:17:24)</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="c1">#   24.     fix author list parsing when there are no authors given (David Brown &lt;dbrown@bnl.gov&gt;, 2012-01-03T16:49:22)</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="c1">#</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="c1">################################################################################</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="kn">import</span> <span class="nn">x4i.exfor_reactions</span> <span class="k">as</span> <span class="nn">exfor_reactions</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="kn">import</span> <span class="nn">x4i.exfor_dicts</span> <span class="k">as</span> <span class="nn">exfor_dicts</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="kn">import</span> <span class="nn">x4i.exfor_grammars</span> <span class="k">as</span> <span class="nn">exfor_grammars</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="kn">import</span> <span class="nn">x4i.exfor_reference</span> <span class="k">as</span> <span class="nn">exfor_reference</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="kn">import</span> <span class="nn">x4i.exfor_exceptions</span> <span class="k">as</span> <span class="nn">exfor_exceptions</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="kn">import</span> <span class="nn">x4i.pyparsing</span> <span class="k">as</span> <span class="nn">pyparsing</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="kn">import</span> <span class="nn">copy</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="k">def</span> <span class="nf">chunkifyX4TextField</span><span class="p">(</span><span class="n">oldtext</span><span class="p">):</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">    Splits an EXFOR text field into chunks, code pieces ( i.e. &quot;(blah, blah)&quot; ) get there own chunks and &quot;free text&quot;</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">    get their own chunks.  Works best on &#39;INSTITUTE&#39; field.  Would be better to move to pyparsing based scheme.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">    @type  oldtext: string</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">    @param oldtext: raw line from an EXFOR file</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">    @rtype: list of strings</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">    @return: list containing the (hopefully) parsed Exfor text field</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">oldtext</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>    <span class="n">text</span> <span class="o">=</span> <span class="n">exfor_grammars</span><span class="o">.</span><span class="n">x4textfield</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">oldtext</span><span class="p">)</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">asList</span><span class="p">()</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="k">def</span> <span class="nf">extractX4FieldType</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">    Extracts the type of field from an EXFOR field.  It should be in cols[0:10] of the field string.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">    @type  field: string</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">    @param field: string containing the EXFOR field</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    @rtype: string or None</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">    @return: the name of the field</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>    <span class="n">tag</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>    <span class="k">return</span> <span class="n">tag</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="k">def</span> <span class="nf">extractX4FieldPointer</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">    Extracts a pointer (if it exists) from an EXFOR field.  It should be in column 10 of the field string.</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">    @type  field: string</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">    @param field: string containing the EXFOR field</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">    @rtype: string or None</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">    @return: the pointer or None if there is none</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>    <span class="n">tag</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">10</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>    <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>    <span class="k">return</span> <span class="n">tag</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="k">class</span> <span class="nc">X4SubField</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">    smallest element of an EXFOR text field; may span several lines</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="sd">&quot;&quot;&quot;Pretty version of subfield (if one exists)&quot;&quot;&quot;</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="sd">&quot;&quot;&quot;EXFOR formatting back&quot;&quot;&quot;</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="mi">11</span> <span class="o">*</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="k">class</span> <span class="nc">X4PlainField</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">    EXFOR plain data field in a Bib Section, with extra character grabbed from tag field to catch possible pointers</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>        <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">raw_field</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="n">pointer</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="k">if</span> <span class="n">raw_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw_field</span><span class="p">:</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">66</span><span class="p">)</span>  <span class="c1"># fill lines to 66 characters</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>                <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>                    <span class="n">pointer</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>                <span class="k">if</span> <span class="n">pointer</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>                    <span class="bp">self</span><span class="p">[</span><span class="n">pointer</span><span class="p">]</span> <span class="o">=</span> <span class="n">X4SubField</span><span class="p">()</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>                <span class="bp">self</span><span class="p">[</span><span class="n">pointer</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">66</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sorted_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sorted_keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>    <span class="k">def</span> <span class="nf">total_len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="sd">&quot;&quot;&quot;Pretty version of field (if one exists)&quot;&quot;&quot;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_keys</span><span class="p">:</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>            <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s1">&#39;] &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">]))</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">]))</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="sd">&quot;&quot;&quot;Gets you back the EXFOR field&quot;&quot;&quot;</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_keys</span><span class="p">:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">11</span><span class="p">:])</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">))[</span><span class="mi">10</span><span class="p">:]</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="k">class</span> <span class="nc">X4ReactionField</span><span class="p">(</span><span class="n">X4PlainField</span><span class="p">):</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>    <span class="sd">&quot;&quot;&quot;Parsed EXFOR Reaction Field&quot;&quot;&quot;</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="n">X4PlainField</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>  <span class="c1"># this should chop reaction field into separate measurements, 1/pointer</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>                <span class="n">f</span> <span class="o">=</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">x4reactionfield</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="k">except</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>                <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">ReactionParsingError</span><span class="p">(</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>                    <span class="s1">&#39;Can not parse reaction &quot;&#39;</span> <span class="o">+</span> <span class="n">d</span> <span class="o">+</span> <span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">    got error &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getMeasurementType</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>    <span class="k">def</span> <span class="nf">getMeasurementType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;//&#39;</span><span class="p">]:</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>                    <span class="k">return</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4ReactionCombination</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>            <span class="k">return</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4Reaction</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="k">except</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">IsomerMathParsingError</span><span class="p">:</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>            <span class="k">return</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4ReactionIsomerCombination</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>    <span class="k">def</span> <span class="nf">getEquation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">schematic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">        Produced a list of strings corresponding to the parsed reaction field.</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">        Arguments ::</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">            * key : the EXFOR pointer (either &#39;&#39; or an integer)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">            * schematic : If True, will return the equation with the strings &quot;rxn 0&quot;, &#39;rxn 1&#39; etc.</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">                where the reactions used to be.  This is good for computer algebra.  If False,</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">                the repr() of the X4Reaction instance.</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4Reaction</span><span class="p">):</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="k">if</span> <span class="n">schematic</span><span class="p">:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>                <span class="k">return</span> <span class="s1">&#39;rxn 0&#39;</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>                <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>                <span class="k">if</span> <span class="n">schematic</span><span class="p">:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;rxn &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">thing</span><span class="p">))</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>    <span class="k">def</span> <span class="nf">getX4ReactionList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">        Produce a list of X4Reaction instances that are present in a reaction string.  For a</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        simple reaction, this is a one element list with the X4Reaction instance in it.  For a</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">        reaction combination, this is a list of X4Reaction instances, entered in order of</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">        occurrence in the reaction string.  The list can be used to fill in the schematic output from</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">        getEquation() to produce the non-schematic version.</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">        Arguments:</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">            * key : the EXFOR pointer (either &#39;&#39; or an integer)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4Reaction</span><span class="p">):</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4Reaction</span><span class="p">):</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="o">==</span> <span class="p">{}:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            <span class="k">return</span> <span class="n">ans</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_keys</span><span class="p">:</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>                <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>                <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="s1">&#39;] &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>                    <span class="n">ans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="k">return</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="k">class</span> <span class="nc">X4MonitorField</span><span class="p">(</span><span class="n">X4ReactionField</span><span class="p">):</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">    Parsed Exfor Monitor Field</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">    The reaction monitors are stored in the ``reactions`` data member, just like an regular X4ReactionField.</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">    This is a Python dict who&#39;s keys are a reaction pointer (&#39; &#39; if there isn&#39;t one) and</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">    value are a list of all monitors for this reaction.  The elements of the list of</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">    monitors are a 3-tuple: ( X4Reaction, free text, DATA column reference ) ::</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">        - The X4Reaction, is the monitor reaction</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">        - The free text is free text entered by the EXFOR compiler</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">        - The DATA column reference is the column header of the monitor reaction data</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">          given in the DATA section of this EXFOR subentry.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="n">X4PlainField</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>  <span class="c1"># this should chop reaction field into separate measurements, 1/pointer</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>            <span class="c1"># Chop field into reactions</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="n">ds</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="n">lineQueue</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="k">while</span> <span class="n">lineQueue</span><span class="p">:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>                <span class="n">line</span> <span class="o">=</span> <span class="n">lineQueue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>                <span class="c1"># Case 1: ((MONIT#(REACTION)) style formatting -- may extend on several lines</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;((&#39;</span><span class="p">):</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>                    <span class="n">ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>                    <span class="k">if</span> <span class="n">ds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">):</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>                        <span class="n">ds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">lineQueue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>                <span class="c1"># Case 2: (REACTION) style formatting -- may also extend on several lines</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">):</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>                    <span class="n">ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>                    <span class="k">if</span> <span class="n">ds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">):</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>                        <span class="n">ds</span> <span class="o">+=</span> <span class="n">lineQueue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>                <span class="c1"># Case 3: Free Text -- may also extend on several lines, let the continuation logic catch this</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>                    <span class="n">ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>                <span class="c1"># A regular continuation line</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>                    <span class="n">ds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>            <span class="c1"># Process each reaction</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>                <span class="n">heading</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>                <span class="k">if</span> <span class="s1">&#39;MONIT&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;((MONIT&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>                        <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>                        <span class="n">d</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>                        <span class="n">heading</span> <span class="o">=</span> <span class="s2">&quot;MONIT&quot;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">):</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>                        <span class="n">f</span> <span class="o">=</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">x4reactionfield</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">getMeasurementType</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">heading</span><span class="p">))</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>                    <span class="k">except</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>                        <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">ReactionParsingError</span><span class="p">(</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>                            <span class="s1">&#39;Can not parse reaction &quot;</span><span class="si">%s</span><span class="s1">&quot; (part of &quot;</span><span class="si">%s</span><span class="s1">&quot;),</span><span class="se">\n</span><span class="s1">    got error </span><span class="si">%s</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ds</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)))</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">heading</span><span class="p">))</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>        <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="o">==</span> <span class="p">{}:</span> <span class="k">return</span> <span class="n">ans</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_keys</span><span class="p">:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>                <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>                <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="s1">&#39;] &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>        <span class="k">return</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="n">pubTypeMap</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="s1">&#39;Abstract&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="s1">&#39;Abstract of Journal&#39;</span><span class="p">,</span> <span class="s1">&#39;J&#39;</span><span class="p">:</span> <span class="s1">&#39;Journal&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="s1">&#39;Conf. Proc.&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="s1">&#39;Conf. Proc.&#39;</span><span class="p">,</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>              <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="s1">&#39;Prog. Report&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="s1">&#39;Lab Report&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="s1">&#39;Book&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="s1">&#39;Private Comm.&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="s1">&#39;Thesis&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="s1">&#39;Preprint&#39;</span><span class="p">}</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="k">class</span> <span class="nc">X4ReferenceField</span><span class="p">(</span><span class="n">X4PlainField</span><span class="p">):</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>    <span class="sd">&quot;&quot;&quot;Parsed EXFOR reference field&quot;&quot;&quot;</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="n">X4PlainField</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>                <span class="n">refs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>                <span class="n">intautology</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>                <span class="n">hastautology</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">]:</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;((&#39;</span><span class="p">:</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>                        <span class="n">intautology</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>                        <span class="n">hastautology</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>                        <span class="n">refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">intautology</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>                        <span class="n">refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>                        <span class="n">refs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>                    <span class="k">if</span> <span class="s1">&#39;))&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>                        <span class="n">intautology</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>                <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>                    <span class="k">if</span> <span class="n">hastautology</span> <span class="ow">and</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">xx</span><span class="p">:</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>                            <span class="n">xref</span> <span class="o">=</span> <span class="n">exfor_reference</span><span class="o">.</span><span class="n">x4refcodetautology</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span><span class="o">.</span><span class="n">asList</span><span class="p">()</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>                        <span class="k">except</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>                            <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">ReferenceParsingError</span><span class="p">(</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>                                <span class="s1">&#39;Can not parse reference &quot;&#39;</span> <span class="o">+</span> <span class="n">xx</span> <span class="o">+</span> <span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">    got error &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">)</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>                        <span class="n">refcomment</span> <span class="o">=</span> <span class="n">xref</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>                        <span class="k">for</span> <span class="n">xxx</span> <span class="ow">in</span> <span class="n">xref</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>                                <span class="k">if</span> <span class="n">xxx</span> <span class="o">!=</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>                                        <span class="p">(</span><span class="n">exfor_reference</span><span class="o">.</span><span class="n">X4ReferenceCode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">xxx</span><span class="p">)),</span> <span class="n">refcomment</span><span class="p">))</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>                            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span><span class="p">,</span> <span class="ne">LookupError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>                                <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">ReferenceParsingError</span><span class="p">(</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>                                    <span class="s1">&#39;Can not parse reference &quot;&#39;</span> <span class="o">+</span> <span class="n">xx</span> <span class="o">+</span> <span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">    got error &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>                        <span class="n">xref</span> <span class="o">=</span> <span class="n">exfor_reference</span><span class="o">.</span><span class="n">x4refcode</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span><span class="o">.</span><span class="n">asList</span><span class="p">()</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>                        <span class="n">refcomment</span> <span class="o">=</span> <span class="n">xref</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">exfor_reference</span><span class="o">.</span><span class="n">X4ReferenceCode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">xref</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">refcomment</span><span class="p">))</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>                        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span><span class="p">,</span> <span class="ne">LookupError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>                            <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">ReferenceParsingError</span><span class="p">(</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>                                <span class="s1">&#39;Can not parse reference &quot;&#39;</span> <span class="o">+</span> <span class="n">xx</span> <span class="o">+</span> <span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">    got error &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">)</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>            <span class="c1"># Take this reference main info from first reference in field that we could parse</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">:</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">exfor_reference</span><span class="o">.</span><span class="n">X4ReferenceCode</span><span class="p">):</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">reftype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reftype</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">details</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pubyear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pubyear</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pubtype</span> <span class="o">=</span> <span class="n">pubTypeMap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reftype</span><span class="p">]</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>                    <span class="k">break</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>        <span class="k">except</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">ReferenceParsingError</span><span class="p">:</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reftype</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Parsing failed&#39;</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">details</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pubyear</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pubtype</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>    <span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>        <span class="sd">&quot;&quot;&quot;flattens nested parens in volume part of a reference&quot;&quot;&quot;</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>            <span class="k">return</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="k">def</span> <span class="nf">parens</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>                <span class="k">return</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>            <span class="k">return</span> <span class="n">x</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">parens</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="sd">&quot;&quot;&quot;Pretty version of field&quot;&quot;&quot;</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>            <span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">]])</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="k">return</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="k">class</span> <span class="nc">X4TitleField</span><span class="p">(</span><span class="n">X4PlainField</span><span class="p">):</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>    <span class="sd">&quot;&quot;&quot;Cleaned up title&quot;&quot;&quot;</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="n">X4PlainField</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        <span class="sd">&#39;&#39;&#39;Pretty version of field&#39;&#39;&#39;</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_keys</span><span class="p">:</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">])</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="k">class</span> <span class="nc">X4AuthorField</span><span class="p">(</span><span class="n">X4PlainField</span><span class="p">):</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>    <span class="sd">&quot;&quot;&quot;Cleaned up author list&quot;&quot;&quot;</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">authors</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">extraData</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="k">for</span> <span class="n">noAuthorString</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;No author given&quot;</span><span class="p">,</span> <span class="s2">&quot;.NOT GIVEN.&quot;</span><span class="p">,</span> <span class="s2">&quot;Not given&quot;</span><span class="p">]:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>            <span class="k">if</span> <span class="n">noAuthorString</span> <span class="ow">in</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">author_family_names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>                <span class="k">return</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="n">X4PlainField</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>            <span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">]])</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>                <span class="n">tt</span> <span class="o">=</span> <span class="n">exfor_grammars</span><span class="o">.</span><span class="n">x4refcode</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">asList</span><span class="p">()</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>            <span class="k">except</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>                    <span class="n">tt</span> <span class="o">=</span> <span class="n">exfor_grammars</span><span class="o">.</span><span class="n">x4refcode</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">asList</span><span class="p">()</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>                    <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">AuthorParsingError</span><span class="p">(</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>                        <span class="s1">&#39;Can not parse authors &quot;&#39;</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">    got error &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>                            <span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot; when parsing as x4refcode</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>                <span class="n">ttt</span> <span class="o">=</span> <span class="n">exfor_grammars</span><span class="o">.</span><span class="n">x4authorlist</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">asList</span><span class="p">()</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>            <span class="k">except</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>                <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">AuthorParsingError</span><span class="p">(</span><span class="s1">&#39;Can not parse authors &quot;&#39;</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">    got error &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>                    <span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot; when parsing as x4authorlist</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">authors</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ttt</span><span class="p">]</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">author_family_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">authors</span><span class="p">]</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="sd">&quot;&quot;&quot;Pretty version of field&quot;&quot;&quot;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">authors</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>            <span class="k">return</span> <span class="s2">&quot;No author given&quot;</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">authors</span><span class="p">)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="k">class</span> <span class="nc">X4InstituteField</span><span class="p">(</span><span class="n">X4PlainField</span><span class="p">):</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>    <span class="sd">&quot;&quot;&quot;Cleaned up institutes list&quot;&quot;&quot;</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>        <span class="n">X4PlainField</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">exfor_institutes_dictionary</span> <span class="o">=</span> <span class="n">exfor_dicts</span><span class="o">.</span><span class="n">X4DictionaryServer</span><span class="p">()[</span><span class="s1">&#39;Institutes&#39;</span><span class="p">]</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">institutes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>                <span class="n">il</span> <span class="o">=</span> <span class="n">exfor_grammars</span><span class="o">.</span><span class="n">x4textfield</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">]))</span><span class="o">.</span><span class="n">asList</span><span class="p">()</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>            <span class="k">except</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>                <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">InstituteParsingError</span><span class="p">(</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>                    <span class="s1">&#39;Can not parse institute &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">    got error &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">)</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">il</span><span class="p">:</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>                <span class="n">tok</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>                <span class="n">comment</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>                <span class="k">if</span> <span class="n">tok</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exfor_institutes_dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">institutes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tok</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exfor_institutes_dictionary</span><span class="p">[</span><span class="n">tok</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]][</span><span class="mi">0</span><span class="p">],</span> <span class="n">comment</span><span class="p">))</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">institutes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tok</span><span class="p">,</span> <span class="n">tok</span><span class="p">,</span> <span class="n">comment</span><span class="p">))</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="sd">&quot;&quot;&quot;Pretty version of field&quot;&quot;&quot;</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>        <span class="n">inst</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">institutes</span><span class="p">:</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>            <span class="n">entry</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">entry</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>            <span class="n">inst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>        <span class="k">return</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
</span></pre></div>

        </details>

            </section>
                <section id="chunkifyX4TextField">
                            <div class="attr function"><a class="headerlink" href="#chunkifyX4TextField">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">chunkifyX4TextField</span><span class="signature">(oldtext)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="chunkifyX4TextField-73"><a href="#chunkifyX4TextField-73"><span class="linenos">73</span></a><span class="k">def</span> <span class="nf">chunkifyX4TextField</span><span class="p">(</span><span class="n">oldtext</span><span class="p">):</span>
</span><span id="chunkifyX4TextField-74"><a href="#chunkifyX4TextField-74"><span class="linenos">74</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="chunkifyX4TextField-75"><a href="#chunkifyX4TextField-75"><span class="linenos">75</span></a><span class="sd">    Splits an EXFOR text field into chunks, code pieces ( i.e. &quot;(blah, blah)&quot; ) get there own chunks and &quot;free text&quot;</span>
</span><span id="chunkifyX4TextField-76"><a href="#chunkifyX4TextField-76"><span class="linenos">76</span></a><span class="sd">    get their own chunks.  Works best on &#39;INSTITUTE&#39; field.  Would be better to move to pyparsing based scheme.</span>
</span><span id="chunkifyX4TextField-77"><a href="#chunkifyX4TextField-77"><span class="linenos">77</span></a><span class="sd">    @type  oldtext: string</span>
</span><span id="chunkifyX4TextField-78"><a href="#chunkifyX4TextField-78"><span class="linenos">78</span></a><span class="sd">    @param oldtext: raw line from an EXFOR file</span>
</span><span id="chunkifyX4TextField-79"><a href="#chunkifyX4TextField-79"><span class="linenos">79</span></a><span class="sd">    @rtype: list of strings</span>
</span><span id="chunkifyX4TextField-80"><a href="#chunkifyX4TextField-80"><span class="linenos">80</span></a><span class="sd">    @return: list containing the (hopefully) parsed Exfor text field</span>
</span><span id="chunkifyX4TextField-81"><a href="#chunkifyX4TextField-81"><span class="linenos">81</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="chunkifyX4TextField-82"><a href="#chunkifyX4TextField-82"><span class="linenos">82</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">oldtext</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="chunkifyX4TextField-83"><a href="#chunkifyX4TextField-83"><span class="linenos">83</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span>
</span><span id="chunkifyX4TextField-84"><a href="#chunkifyX4TextField-84"><span class="linenos">84</span></a>    <span class="n">text</span> <span class="o">=</span> <span class="n">exfor_grammars</span><span class="o">.</span><span class="n">x4textfield</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">oldtext</span><span class="p">)</span>
</span><span id="chunkifyX4TextField-85"><a href="#chunkifyX4TextField-85"><span class="linenos">85</span></a>    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">asList</span><span class="p">()</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Splits an EXFOR text field into chunks, code pieces ( i.e. "(blah, blah)" ) get there own chunks and "free text"
get their own chunks.  Works best on 'INSTITUTE' field.  Would be better to move to pyparsing based scheme.
@type  oldtext: string
@param oldtext: raw line from an EXFOR file
@rtype: list of strings
@return: list containing the (hopefully) parsed Exfor text field</p>
</div>


                </section>
                <section id="extractX4FieldType">
                            <div class="attr function"><a class="headerlink" href="#extractX4FieldType">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">extractX4FieldType</span><span class="signature">(field)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="extractX4FieldType-88"><a href="#extractX4FieldType-88"><span class="linenos">88</span></a><span class="k">def</span> <span class="nf">extractX4FieldType</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
</span><span id="extractX4FieldType-89"><a href="#extractX4FieldType-89"><span class="linenos">89</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="extractX4FieldType-90"><a href="#extractX4FieldType-90"><span class="linenos">90</span></a><span class="sd">    Extracts the type of field from an EXFOR field.  It should be in cols[0:10] of the field string.</span>
</span><span id="extractX4FieldType-91"><a href="#extractX4FieldType-91"><span class="linenos">91</span></a><span class="sd">    @type  field: string</span>
</span><span id="extractX4FieldType-92"><a href="#extractX4FieldType-92"><span class="linenos">92</span></a><span class="sd">    @param field: string containing the EXFOR field</span>
</span><span id="extractX4FieldType-93"><a href="#extractX4FieldType-93"><span class="linenos">93</span></a><span class="sd">    @rtype: string or None</span>
</span><span id="extractX4FieldType-94"><a href="#extractX4FieldType-94"><span class="linenos">94</span></a><span class="sd">    @return: the name of the field</span>
</span><span id="extractX4FieldType-95"><a href="#extractX4FieldType-95"><span class="linenos">95</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="extractX4FieldType-96"><a href="#extractX4FieldType-96"><span class="linenos">96</span></a>    <span class="n">tag</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="extractX4FieldType-97"><a href="#extractX4FieldType-97"><span class="linenos">97</span></a>    <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="extractX4FieldType-98"><a href="#extractX4FieldType-98"><span class="linenos">98</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="extractX4FieldType-99"><a href="#extractX4FieldType-99"><span class="linenos">99</span></a>    <span class="k">return</span> <span class="n">tag</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Extracts the type of field from an EXFOR field.  It should be in cols[0:10] of the field string.
@type  field: string
@param field: string containing the EXFOR field
@rtype: string or None
@return: the name of the field</p>
</div>


                </section>
                <section id="extractX4FieldPointer">
                            <div class="attr function"><a class="headerlink" href="#extractX4FieldPointer">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">extractX4FieldPointer</span><span class="signature">(field)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="extractX4FieldPointer-102"><a href="#extractX4FieldPointer-102"><span class="linenos">102</span></a><span class="k">def</span> <span class="nf">extractX4FieldPointer</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
</span><span id="extractX4FieldPointer-103"><a href="#extractX4FieldPointer-103"><span class="linenos">103</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="extractX4FieldPointer-104"><a href="#extractX4FieldPointer-104"><span class="linenos">104</span></a><span class="sd">    Extracts a pointer (if it exists) from an EXFOR field.  It should be in column 10 of the field string.</span>
</span><span id="extractX4FieldPointer-105"><a href="#extractX4FieldPointer-105"><span class="linenos">105</span></a><span class="sd">    @type  field: string</span>
</span><span id="extractX4FieldPointer-106"><a href="#extractX4FieldPointer-106"><span class="linenos">106</span></a><span class="sd">    @param field: string containing the EXFOR field</span>
</span><span id="extractX4FieldPointer-107"><a href="#extractX4FieldPointer-107"><span class="linenos">107</span></a><span class="sd">    @rtype: string or None</span>
</span><span id="extractX4FieldPointer-108"><a href="#extractX4FieldPointer-108"><span class="linenos">108</span></a><span class="sd">    @return: the pointer or None if there is none</span>
</span><span id="extractX4FieldPointer-109"><a href="#extractX4FieldPointer-109"><span class="linenos">109</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="extractX4FieldPointer-110"><a href="#extractX4FieldPointer-110"><span class="linenos">110</span></a>    <span class="n">tag</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">10</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="extractX4FieldPointer-111"><a href="#extractX4FieldPointer-111"><span class="linenos">111</span></a>    <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="extractX4FieldPointer-112"><a href="#extractX4FieldPointer-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="extractX4FieldPointer-113"><a href="#extractX4FieldPointer-113"><span class="linenos">113</span></a>    <span class="k">return</span> <span class="n">tag</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Extracts a pointer (if it exists) from an EXFOR field.  It should be in column 10 of the field string.
@type  field: string
@param field: string containing the EXFOR field
@rtype: string or None
@return: the pointer or None if there is none</p>
</div>


                </section>
                <section id="X4SubField">
                                <div class="attr class">
        <a class="headerlink" href="#X4SubField">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">X4SubField</span><wbr>(<span class="base">builtins.list</span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="X4SubField-116"><a href="#X4SubField-116"><span class="linenos">116</span></a><span class="k">class</span> <span class="nc">X4SubField</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
</span><span id="X4SubField-117"><a href="#X4SubField-117"><span class="linenos">117</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="X4SubField-118"><a href="#X4SubField-118"><span class="linenos">118</span></a><span class="sd">    smallest element of an EXFOR text field; may span several lines</span>
</span><span id="X4SubField-119"><a href="#X4SubField-119"><span class="linenos">119</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="X4SubField-120"><a href="#X4SubField-120"><span class="linenos">120</span></a>
</span><span id="X4SubField-121"><a href="#X4SubField-121"><span class="linenos">121</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="X4SubField-122"><a href="#X4SubField-122"><span class="linenos">122</span></a>        <span class="sd">&quot;&quot;&quot;Pretty version of subfield (if one exists)&quot;&quot;&quot;</span>
</span><span id="X4SubField-123"><a href="#X4SubField-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>
</span><span id="X4SubField-124"><a href="#X4SubField-124"><span class="linenos">124</span></a>
</span><span id="X4SubField-125"><a href="#X4SubField-125"><span class="linenos">125</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="X4SubField-126"><a href="#X4SubField-126"><span class="linenos">126</span></a>        <span class="sd">&quot;&quot;&quot;EXFOR formatting back&quot;&quot;&quot;</span>
</span><span id="X4SubField-127"><a href="#X4SubField-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="mi">11</span> <span class="o">*</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>smallest element of an EXFOR text field; may span several lines</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.list</dt>
                                <dd id="X4SubField.__init__" class="function">list</dd>
                <dd id="X4SubField.clear" class="function">clear</dd>
                <dd id="X4SubField.copy" class="function">copy</dd>
                <dd id="X4SubField.append" class="function">append</dd>
                <dd id="X4SubField.insert" class="function">insert</dd>
                <dd id="X4SubField.extend" class="function">extend</dd>
                <dd id="X4SubField.pop" class="function">pop</dd>
                <dd id="X4SubField.remove" class="function">remove</dd>
                <dd id="X4SubField.index" class="function">index</dd>
                <dd id="X4SubField.count" class="function">count</dd>
                <dd id="X4SubField.reverse" class="function">reverse</dd>
                <dd id="X4SubField.sort" class="function">sort</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="X4PlainField">
                                <div class="attr class">
        <a class="headerlink" href="#X4PlainField">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">X4PlainField</span><wbr>(<span class="base">builtins.dict</span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="X4PlainField-130"><a href="#X4PlainField-130"><span class="linenos">130</span></a><span class="k">class</span> <span class="nc">X4PlainField</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
</span><span id="X4PlainField-131"><a href="#X4PlainField-131"><span class="linenos">131</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="X4PlainField-132"><a href="#X4PlainField-132"><span class="linenos">132</span></a><span class="sd">    EXFOR plain data field in a Bib Section, with extra character grabbed from tag field to catch possible pointers</span>
</span><span id="X4PlainField-133"><a href="#X4PlainField-133"><span class="linenos">133</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="X4PlainField-134"><a href="#X4PlainField-134"><span class="linenos">134</span></a>
</span><span id="X4PlainField-135"><a href="#X4PlainField-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="X4PlainField-136"><a href="#X4PlainField-136"><span class="linenos">136</span></a>        <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="X4PlainField-137"><a href="#X4PlainField-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">raw_field</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="X4PlainField-138"><a href="#X4PlainField-138"><span class="linenos">138</span></a>        <span class="n">pointer</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
</span><span id="X4PlainField-139"><a href="#X4PlainField-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="n">raw_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="X4PlainField-140"><a href="#X4PlainField-140"><span class="linenos">140</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw_field</span><span class="p">:</span>
</span><span id="X4PlainField-141"><a href="#X4PlainField-141"><span class="linenos">141</span></a>                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">66</span><span class="p">)</span>  <span class="c1"># fill lines to 66 characters</span>
</span><span id="X4PlainField-142"><a href="#X4PlainField-142"><span class="linenos">142</span></a>                <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
</span><span id="X4PlainField-143"><a href="#X4PlainField-143"><span class="linenos">143</span></a>                    <span class="n">pointer</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
</span><span id="X4PlainField-144"><a href="#X4PlainField-144"><span class="linenos">144</span></a>                <span class="k">if</span> <span class="n">pointer</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="X4PlainField-145"><a href="#X4PlainField-145"><span class="linenos">145</span></a>                    <span class="bp">self</span><span class="p">[</span><span class="n">pointer</span><span class="p">]</span> <span class="o">=</span> <span class="n">X4SubField</span><span class="p">()</span>
</span><span id="X4PlainField-146"><a href="#X4PlainField-146"><span class="linenos">146</span></a>                <span class="bp">self</span><span class="p">[</span><span class="n">pointer</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">66</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
</span><span id="X4PlainField-147"><a href="#X4PlainField-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sorted_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="X4PlainField-148"><a href="#X4PlainField-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sorted_keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="X4PlainField-149"><a href="#X4PlainField-149"><span class="linenos">149</span></a>
</span><span id="X4PlainField-150"><a href="#X4PlainField-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="nf">total_len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="X4PlainField-151"><a href="#X4PlainField-151"><span class="linenos">151</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>
</span><span id="X4PlainField-152"><a href="#X4PlainField-152"><span class="linenos">152</span></a>
</span><span id="X4PlainField-153"><a href="#X4PlainField-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="X4PlainField-154"><a href="#X4PlainField-154"><span class="linenos">154</span></a>        <span class="sd">&quot;&quot;&quot;Pretty version of field (if one exists)&quot;&quot;&quot;</span>
</span><span id="X4PlainField-155"><a href="#X4PlainField-155"><span class="linenos">155</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4PlainField-156"><a href="#X4PlainField-156"><span class="linenos">156</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_keys</span><span class="p">:</span>
</span><span id="X4PlainField-157"><a href="#X4PlainField-157"><span class="linenos">157</span></a>            <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
</span><span id="X4PlainField-158"><a href="#X4PlainField-158"><span class="linenos">158</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s1">&#39;] &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">]))</span>
</span><span id="X4PlainField-159"><a href="#X4PlainField-159"><span class="linenos">159</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="X4PlainField-160"><a href="#X4PlainField-160"><span class="linenos">160</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">]))</span>
</span><span id="X4PlainField-161"><a href="#X4PlainField-161"><span class="linenos">161</span></a>        <span class="k">return</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="X4PlainField-162"><a href="#X4PlainField-162"><span class="linenos">162</span></a>
</span><span id="X4PlainField-163"><a href="#X4PlainField-163"><span class="linenos">163</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="X4PlainField-164"><a href="#X4PlainField-164"><span class="linenos">164</span></a>        <span class="sd">&quot;&quot;&quot;Gets you back the EXFOR field&quot;&quot;&quot;</span>
</span><span id="X4PlainField-165"><a href="#X4PlainField-165"><span class="linenos">165</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4PlainField-166"><a href="#X4PlainField-166"><span class="linenos">166</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_keys</span><span class="p">:</span>
</span><span id="X4PlainField-167"><a href="#X4PlainField-167"><span class="linenos">167</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
</span><span id="X4PlainField-168"><a href="#X4PlainField-168"><span class="linenos">168</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">11</span><span class="p">:])</span>
</span><span id="X4PlainField-169"><a href="#X4PlainField-169"><span class="linenos">169</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">))[</span><span class="mi">10</span><span class="p">:]</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>EXFOR plain data field in a Bib Section, with extra character grabbed from tag field to catch possible pointers</p>
</div>


                            <div id="X4PlainField.total_len" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#X4PlainField.total_len">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">total_len</span><span class="signature">(self)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="X4PlainField.total_len-150"><a href="#X4PlainField.total_len-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="nf">total_len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="X4PlainField.total_len-151"><a href="#X4PlainField.total_len-151"><span class="linenos">151</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>
</span></pre></div>

        </details>

    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.dict</dt>
                                <dd id="X4PlainField.get" class="function">get</dd>
                <dd id="X4PlainField.setdefault" class="function">setdefault</dd>
                <dd id="X4PlainField.pop" class="function">pop</dd>
                <dd id="X4PlainField.popitem" class="function">popitem</dd>
                <dd id="X4PlainField.keys" class="function">keys</dd>
                <dd id="X4PlainField.items" class="function">items</dd>
                <dd id="X4PlainField.values" class="function">values</dd>
                <dd id="X4PlainField.update" class="function">update</dd>
                <dd id="X4PlainField.fromkeys" class="function">fromkeys</dd>
                <dd id="X4PlainField.clear" class="function">clear</dd>
                <dd id="X4PlainField.copy" class="function">copy</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="X4ReactionField">
                                <div class="attr class">
        <a class="headerlink" href="#X4ReactionField">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">X4ReactionField</span><wbr>(<span class="base"><a href="#X4PlainField">X4PlainField</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="X4ReactionField-172"><a href="#X4ReactionField-172"><span class="linenos">172</span></a><span class="k">class</span> <span class="nc">X4ReactionField</span><span class="p">(</span><span class="n">X4PlainField</span><span class="p">):</span>
</span><span id="X4ReactionField-173"><a href="#X4ReactionField-173"><span class="linenos">173</span></a>    <span class="sd">&quot;&quot;&quot;Parsed EXFOR Reaction Field&quot;&quot;&quot;</span>
</span><span id="X4ReactionField-174"><a href="#X4ReactionField-174"><span class="linenos">174</span></a>
</span><span id="X4ReactionField-175"><a href="#X4ReactionField-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="X4ReactionField-176"><a href="#X4ReactionField-176"><span class="linenos">176</span></a>        <span class="n">X4PlainField</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>  <span class="c1"># this should chop reaction field into separate measurements, 1/pointer</span>
</span><span id="X4ReactionField-177"><a href="#X4ReactionField-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="X4ReactionField-178"><a href="#X4ReactionField-178"><span class="linenos">178</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="X4ReactionField-179"><a href="#X4ReactionField-179"><span class="linenos">179</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
</span><span id="X4ReactionField-180"><a href="#X4ReactionField-180"><span class="linenos">180</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="X4ReactionField-181"><a href="#X4ReactionField-181"><span class="linenos">181</span></a>                <span class="n">f</span> <span class="o">=</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">x4reactionfield</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span><span id="X4ReactionField-182"><a href="#X4ReactionField-182"><span class="linenos">182</span></a>            <span class="k">except</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="X4ReactionField-183"><a href="#X4ReactionField-183"><span class="linenos">183</span></a>                <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">ReactionParsingError</span><span class="p">(</span>
</span><span id="X4ReactionField-184"><a href="#X4ReactionField-184"><span class="linenos">184</span></a>                    <span class="s1">&#39;Can not parse reaction &quot;&#39;</span> <span class="o">+</span> <span class="n">d</span> <span class="o">+</span> <span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">    got error &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">)</span>
</span><span id="X4ReactionField-185"><a href="#X4ReactionField-185"><span class="linenos">185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getMeasurementType</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="X4ReactionField-186"><a href="#X4ReactionField-186"><span class="linenos">186</span></a>
</span><span id="X4ReactionField-187"><a href="#X4ReactionField-187"><span class="linenos">187</span></a>    <span class="k">def</span> <span class="nf">getMeasurementType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="X4ReactionField-188"><a href="#X4ReactionField-188"><span class="linenos">188</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="X4ReactionField-189"><a href="#X4ReactionField-189"><span class="linenos">189</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;//&#39;</span><span class="p">]:</span>
</span><span id="X4ReactionField-190"><a href="#X4ReactionField-190"><span class="linenos">190</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
</span><span id="X4ReactionField-191"><a href="#X4ReactionField-191"><span class="linenos">191</span></a>                    <span class="k">return</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4ReactionCombination</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="X4ReactionField-192"><a href="#X4ReactionField-192"><span class="linenos">192</span></a>            <span class="k">return</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4Reaction</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="X4ReactionField-193"><a href="#X4ReactionField-193"><span class="linenos">193</span></a>        <span class="k">except</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">IsomerMathParsingError</span><span class="p">:</span>
</span><span id="X4ReactionField-194"><a href="#X4ReactionField-194"><span class="linenos">194</span></a>            <span class="k">return</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4ReactionIsomerCombination</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="X4ReactionField-195"><a href="#X4ReactionField-195"><span class="linenos">195</span></a>
</span><span id="X4ReactionField-196"><a href="#X4ReactionField-196"><span class="linenos">196</span></a>    <span class="k">def</span> <span class="nf">getEquation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">schematic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="X4ReactionField-197"><a href="#X4ReactionField-197"><span class="linenos">197</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="X4ReactionField-198"><a href="#X4ReactionField-198"><span class="linenos">198</span></a><span class="sd">        Produced a list of strings corresponding to the parsed reaction field.</span>
</span><span id="X4ReactionField-199"><a href="#X4ReactionField-199"><span class="linenos">199</span></a>
</span><span id="X4ReactionField-200"><a href="#X4ReactionField-200"><span class="linenos">200</span></a><span class="sd">        Arguments ::</span>
</span><span id="X4ReactionField-201"><a href="#X4ReactionField-201"><span class="linenos">201</span></a>
</span><span id="X4ReactionField-202"><a href="#X4ReactionField-202"><span class="linenos">202</span></a><span class="sd">            * key : the EXFOR pointer (either &#39;&#39; or an integer)</span>
</span><span id="X4ReactionField-203"><a href="#X4ReactionField-203"><span class="linenos">203</span></a><span class="sd">            * schematic : If True, will return the equation with the strings &quot;rxn 0&quot;, &#39;rxn 1&#39; etc.</span>
</span><span id="X4ReactionField-204"><a href="#X4ReactionField-204"><span class="linenos">204</span></a><span class="sd">                where the reactions used to be.  This is good for computer algebra.  If False,</span>
</span><span id="X4ReactionField-205"><a href="#X4ReactionField-205"><span class="linenos">205</span></a><span class="sd">                the repr() of the X4Reaction instance.</span>
</span><span id="X4ReactionField-206"><a href="#X4ReactionField-206"><span class="linenos">206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="X4ReactionField-207"><a href="#X4ReactionField-207"><span class="linenos">207</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4ReactionField-208"><a href="#X4ReactionField-208"><span class="linenos">208</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="X4ReactionField-209"><a href="#X4ReactionField-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4Reaction</span><span class="p">):</span>
</span><span id="X4ReactionField-210"><a href="#X4ReactionField-210"><span class="linenos">210</span></a>            <span class="k">if</span> <span class="n">schematic</span><span class="p">:</span>
</span><span id="X4ReactionField-211"><a href="#X4ReactionField-211"><span class="linenos">211</span></a>                <span class="k">return</span> <span class="s1">&#39;rxn 0&#39;</span>
</span><span id="X4ReactionField-212"><a href="#X4ReactionField-212"><span class="linenos">212</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="X4ReactionField-213"><a href="#X4ReactionField-213"><span class="linenos">213</span></a>                <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="X4ReactionField-214"><a href="#X4ReactionField-214"><span class="linenos">214</span></a>        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span><span id="X4ReactionField-215"><a href="#X4ReactionField-215"><span class="linenos">215</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="X4ReactionField-216"><a href="#X4ReactionField-216"><span class="linenos">216</span></a>                <span class="k">if</span> <span class="n">schematic</span><span class="p">:</span>
</span><span id="X4ReactionField-217"><a href="#X4ReactionField-217"><span class="linenos">217</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;rxn &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span id="X4ReactionField-218"><a href="#X4ReactionField-218"><span class="linenos">218</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="X4ReactionField-219"><a href="#X4ReactionField-219"><span class="linenos">219</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">thing</span><span class="p">))</span>
</span><span id="X4ReactionField-220"><a href="#X4ReactionField-220"><span class="linenos">220</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="X4ReactionField-221"><a href="#X4ReactionField-221"><span class="linenos">221</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="X4ReactionField-222"><a href="#X4ReactionField-222"><span class="linenos">222</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
</span><span id="X4ReactionField-223"><a href="#X4ReactionField-223"><span class="linenos">223</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="X4ReactionField-224"><a href="#X4ReactionField-224"><span class="linenos">224</span></a>
</span><span id="X4ReactionField-225"><a href="#X4ReactionField-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="nf">getX4ReactionList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span id="X4ReactionField-226"><a href="#X4ReactionField-226"><span class="linenos">226</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="X4ReactionField-227"><a href="#X4ReactionField-227"><span class="linenos">227</span></a><span class="sd">        Produce a list of X4Reaction instances that are present in a reaction string.  For a</span>
</span><span id="X4ReactionField-228"><a href="#X4ReactionField-228"><span class="linenos">228</span></a><span class="sd">        simple reaction, this is a one element list with the X4Reaction instance in it.  For a</span>
</span><span id="X4ReactionField-229"><a href="#X4ReactionField-229"><span class="linenos">229</span></a><span class="sd">        reaction combination, this is a list of X4Reaction instances, entered in order of</span>
</span><span id="X4ReactionField-230"><a href="#X4ReactionField-230"><span class="linenos">230</span></a><span class="sd">        occurrence in the reaction string.  The list can be used to fill in the schematic output from</span>
</span><span id="X4ReactionField-231"><a href="#X4ReactionField-231"><span class="linenos">231</span></a><span class="sd">        getEquation() to produce the non-schematic version.</span>
</span><span id="X4ReactionField-232"><a href="#X4ReactionField-232"><span class="linenos">232</span></a>
</span><span id="X4ReactionField-233"><a href="#X4ReactionField-233"><span class="linenos">233</span></a><span class="sd">        Arguments:</span>
</span><span id="X4ReactionField-234"><a href="#X4ReactionField-234"><span class="linenos">234</span></a>
</span><span id="X4ReactionField-235"><a href="#X4ReactionField-235"><span class="linenos">235</span></a><span class="sd">            * key : the EXFOR pointer (either &#39;&#39; or an integer)</span>
</span><span id="X4ReactionField-236"><a href="#X4ReactionField-236"><span class="linenos">236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="X4ReactionField-237"><a href="#X4ReactionField-237"><span class="linenos">237</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4Reaction</span><span class="p">):</span>
</span><span id="X4ReactionField-238"><a href="#X4ReactionField-238"><span class="linenos">238</span></a>            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="X4ReactionField-239"><a href="#X4ReactionField-239"><span class="linenos">239</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4ReactionField-240"><a href="#X4ReactionField-240"><span class="linenos">240</span></a>        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span><span id="X4ReactionField-241"><a href="#X4ReactionField-241"><span class="linenos">241</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4Reaction</span><span class="p">):</span>
</span><span id="X4ReactionField-242"><a href="#X4ReactionField-242"><span class="linenos">242</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
</span><span id="X4ReactionField-243"><a href="#X4ReactionField-243"><span class="linenos">243</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="X4ReactionField-244"><a href="#X4ReactionField-244"><span class="linenos">244</span></a>
</span><span id="X4ReactionField-245"><a href="#X4ReactionField-245"><span class="linenos">245</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="X4ReactionField-246"><a href="#X4ReactionField-246"><span class="linenos">246</span></a>        <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4ReactionField-247"><a href="#X4ReactionField-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="o">==</span> <span class="p">{}:</span>
</span><span id="X4ReactionField-248"><a href="#X4ReactionField-248"><span class="linenos">248</span></a>            <span class="k">return</span> <span class="n">ans</span>
</span><span id="X4ReactionField-249"><a href="#X4ReactionField-249"><span class="linenos">249</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_keys</span><span class="p">:</span>
</span><span id="X4ReactionField-250"><a href="#X4ReactionField-250"><span class="linenos">250</span></a>            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
</span><span id="X4ReactionField-251"><a href="#X4ReactionField-251"><span class="linenos">251</span></a>                <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="X4ReactionField-252"><a href="#X4ReactionField-252"><span class="linenos">252</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="X4ReactionField-253"><a href="#X4ReactionField-253"><span class="linenos">253</span></a>                <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="s1">&#39;] &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="X4ReactionField-254"><a href="#X4ReactionField-254"><span class="linenos">254</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="X4ReactionField-255"><a href="#X4ReactionField-255"><span class="linenos">255</span></a>                    <span class="n">ans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="X4ReactionField-256"><a href="#X4ReactionField-256"><span class="linenos">256</span></a>        <span class="k">return</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Parsed EXFOR Reaction Field</p>
</div>


                            <div id="X4ReactionField.getMeasurementType" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#X4ReactionField.getMeasurementType">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">getMeasurementType</span><span class="signature">(self, x)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="X4ReactionField.getMeasurementType-187"><a href="#X4ReactionField.getMeasurementType-187"><span class="linenos">187</span></a>    <span class="k">def</span> <span class="nf">getMeasurementType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="X4ReactionField.getMeasurementType-188"><a href="#X4ReactionField.getMeasurementType-188"><span class="linenos">188</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="X4ReactionField.getMeasurementType-189"><a href="#X4ReactionField.getMeasurementType-189"><span class="linenos">189</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;//&#39;</span><span class="p">]:</span>
</span><span id="X4ReactionField.getMeasurementType-190"><a href="#X4ReactionField.getMeasurementType-190"><span class="linenos">190</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
</span><span id="X4ReactionField.getMeasurementType-191"><a href="#X4ReactionField.getMeasurementType-191"><span class="linenos">191</span></a>                    <span class="k">return</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4ReactionCombination</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="X4ReactionField.getMeasurementType-192"><a href="#X4ReactionField.getMeasurementType-192"><span class="linenos">192</span></a>            <span class="k">return</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4Reaction</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="X4ReactionField.getMeasurementType-193"><a href="#X4ReactionField.getMeasurementType-193"><span class="linenos">193</span></a>        <span class="k">except</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">IsomerMathParsingError</span><span class="p">:</span>
</span><span id="X4ReactionField.getMeasurementType-194"><a href="#X4ReactionField.getMeasurementType-194"><span class="linenos">194</span></a>            <span class="k">return</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4ReactionIsomerCombination</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></pre></div>

        </details>

    

                            </div>
                            <div id="X4ReactionField.getEquation" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#X4ReactionField.getEquation">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">getEquation</span><span class="signature">(self, key, schematic=False)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="X4ReactionField.getEquation-196"><a href="#X4ReactionField.getEquation-196"><span class="linenos">196</span></a>    <span class="k">def</span> <span class="nf">getEquation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">schematic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="X4ReactionField.getEquation-197"><a href="#X4ReactionField.getEquation-197"><span class="linenos">197</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="X4ReactionField.getEquation-198"><a href="#X4ReactionField.getEquation-198"><span class="linenos">198</span></a><span class="sd">        Produced a list of strings corresponding to the parsed reaction field.</span>
</span><span id="X4ReactionField.getEquation-199"><a href="#X4ReactionField.getEquation-199"><span class="linenos">199</span></a>
</span><span id="X4ReactionField.getEquation-200"><a href="#X4ReactionField.getEquation-200"><span class="linenos">200</span></a><span class="sd">        Arguments ::</span>
</span><span id="X4ReactionField.getEquation-201"><a href="#X4ReactionField.getEquation-201"><span class="linenos">201</span></a>
</span><span id="X4ReactionField.getEquation-202"><a href="#X4ReactionField.getEquation-202"><span class="linenos">202</span></a><span class="sd">            * key : the EXFOR pointer (either &#39;&#39; or an integer)</span>
</span><span id="X4ReactionField.getEquation-203"><a href="#X4ReactionField.getEquation-203"><span class="linenos">203</span></a><span class="sd">            * schematic : If True, will return the equation with the strings &quot;rxn 0&quot;, &#39;rxn 1&#39; etc.</span>
</span><span id="X4ReactionField.getEquation-204"><a href="#X4ReactionField.getEquation-204"><span class="linenos">204</span></a><span class="sd">                where the reactions used to be.  This is good for computer algebra.  If False,</span>
</span><span id="X4ReactionField.getEquation-205"><a href="#X4ReactionField.getEquation-205"><span class="linenos">205</span></a><span class="sd">                the repr() of the X4Reaction instance.</span>
</span><span id="X4ReactionField.getEquation-206"><a href="#X4ReactionField.getEquation-206"><span class="linenos">206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="X4ReactionField.getEquation-207"><a href="#X4ReactionField.getEquation-207"><span class="linenos">207</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4ReactionField.getEquation-208"><a href="#X4ReactionField.getEquation-208"><span class="linenos">208</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="X4ReactionField.getEquation-209"><a href="#X4ReactionField.getEquation-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4Reaction</span><span class="p">):</span>
</span><span id="X4ReactionField.getEquation-210"><a href="#X4ReactionField.getEquation-210"><span class="linenos">210</span></a>            <span class="k">if</span> <span class="n">schematic</span><span class="p">:</span>
</span><span id="X4ReactionField.getEquation-211"><a href="#X4ReactionField.getEquation-211"><span class="linenos">211</span></a>                <span class="k">return</span> <span class="s1">&#39;rxn 0&#39;</span>
</span><span id="X4ReactionField.getEquation-212"><a href="#X4ReactionField.getEquation-212"><span class="linenos">212</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="X4ReactionField.getEquation-213"><a href="#X4ReactionField.getEquation-213"><span class="linenos">213</span></a>                <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="X4ReactionField.getEquation-214"><a href="#X4ReactionField.getEquation-214"><span class="linenos">214</span></a>        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span><span id="X4ReactionField.getEquation-215"><a href="#X4ReactionField.getEquation-215"><span class="linenos">215</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="X4ReactionField.getEquation-216"><a href="#X4ReactionField.getEquation-216"><span class="linenos">216</span></a>                <span class="k">if</span> <span class="n">schematic</span><span class="p">:</span>
</span><span id="X4ReactionField.getEquation-217"><a href="#X4ReactionField.getEquation-217"><span class="linenos">217</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;rxn &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span id="X4ReactionField.getEquation-218"><a href="#X4ReactionField.getEquation-218"><span class="linenos">218</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="X4ReactionField.getEquation-219"><a href="#X4ReactionField.getEquation-219"><span class="linenos">219</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">thing</span><span class="p">))</span>
</span><span id="X4ReactionField.getEquation-220"><a href="#X4ReactionField.getEquation-220"><span class="linenos">220</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="X4ReactionField.getEquation-221"><a href="#X4ReactionField.getEquation-221"><span class="linenos">221</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="X4ReactionField.getEquation-222"><a href="#X4ReactionField.getEquation-222"><span class="linenos">222</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
</span><span id="X4ReactionField.getEquation-223"><a href="#X4ReactionField.getEquation-223"><span class="linenos">223</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Produced a list of strings corresponding to the parsed reaction field.</p>

<p>Arguments ::</p>

<pre><code>* key : the EXFOR pointer (either '' or an integer)
* schematic : If True, will return the equation with the strings "rxn 0", 'rxn 1' etc.
    where the reactions used to be.  This is good for computer algebra.  If False,
    the repr() of the X4Reaction instance.
</code></pre>
</div>


                            </div>
                            <div id="X4ReactionField.getX4ReactionList" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#X4ReactionField.getX4ReactionList">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">getX4ReactionList</span><span class="signature">(self, key)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="X4ReactionField.getX4ReactionList-225"><a href="#X4ReactionField.getX4ReactionList-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="nf">getX4ReactionList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span id="X4ReactionField.getX4ReactionList-226"><a href="#X4ReactionField.getX4ReactionList-226"><span class="linenos">226</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="X4ReactionField.getX4ReactionList-227"><a href="#X4ReactionField.getX4ReactionList-227"><span class="linenos">227</span></a><span class="sd">        Produce a list of X4Reaction instances that are present in a reaction string.  For a</span>
</span><span id="X4ReactionField.getX4ReactionList-228"><a href="#X4ReactionField.getX4ReactionList-228"><span class="linenos">228</span></a><span class="sd">        simple reaction, this is a one element list with the X4Reaction instance in it.  For a</span>
</span><span id="X4ReactionField.getX4ReactionList-229"><a href="#X4ReactionField.getX4ReactionList-229"><span class="linenos">229</span></a><span class="sd">        reaction combination, this is a list of X4Reaction instances, entered in order of</span>
</span><span id="X4ReactionField.getX4ReactionList-230"><a href="#X4ReactionField.getX4ReactionList-230"><span class="linenos">230</span></a><span class="sd">        occurrence in the reaction string.  The list can be used to fill in the schematic output from</span>
</span><span id="X4ReactionField.getX4ReactionList-231"><a href="#X4ReactionField.getX4ReactionList-231"><span class="linenos">231</span></a><span class="sd">        getEquation() to produce the non-schematic version.</span>
</span><span id="X4ReactionField.getX4ReactionList-232"><a href="#X4ReactionField.getX4ReactionList-232"><span class="linenos">232</span></a>
</span><span id="X4ReactionField.getX4ReactionList-233"><a href="#X4ReactionField.getX4ReactionList-233"><span class="linenos">233</span></a><span class="sd">        Arguments:</span>
</span><span id="X4ReactionField.getX4ReactionList-234"><a href="#X4ReactionField.getX4ReactionList-234"><span class="linenos">234</span></a>
</span><span id="X4ReactionField.getX4ReactionList-235"><a href="#X4ReactionField.getX4ReactionList-235"><span class="linenos">235</span></a><span class="sd">            * key : the EXFOR pointer (either &#39;&#39; or an integer)</span>
</span><span id="X4ReactionField.getX4ReactionList-236"><a href="#X4ReactionField.getX4ReactionList-236"><span class="linenos">236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="X4ReactionField.getX4ReactionList-237"><a href="#X4ReactionField.getX4ReactionList-237"><span class="linenos">237</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4Reaction</span><span class="p">):</span>
</span><span id="X4ReactionField.getX4ReactionList-238"><a href="#X4ReactionField.getX4ReactionList-238"><span class="linenos">238</span></a>            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="X4ReactionField.getX4ReactionList-239"><a href="#X4ReactionField.getX4ReactionList-239"><span class="linenos">239</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4ReactionField.getX4ReactionList-240"><a href="#X4ReactionField.getX4ReactionList-240"><span class="linenos">240</span></a>        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span><span id="X4ReactionField.getX4ReactionList-241"><a href="#X4ReactionField.getX4ReactionList-241"><span class="linenos">241</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">X4Reaction</span><span class="p">):</span>
</span><span id="X4ReactionField.getX4ReactionList-242"><a href="#X4ReactionField.getX4ReactionList-242"><span class="linenos">242</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
</span><span id="X4ReactionField.getX4ReactionList-243"><a href="#X4ReactionField.getX4ReactionList-243"><span class="linenos">243</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Produce a list of X4Reaction instances that are present in a reaction string.  For a
simple reaction, this is a one element list with the X4Reaction instance in it.  For a
reaction combination, this is a list of X4Reaction instances, entered in order of
occurrence in the reaction string.  The list can be used to fill in the schematic output from
getEquation() to produce the non-schematic version.</p>

<p>Arguments:</p>

<pre><code>* key : the EXFOR pointer (either '' or an integer)
</code></pre>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#X4PlainField">X4PlainField</a></dt>
                                <dd id="X4ReactionField.total_len" class="function"><a href="#X4PlainField.total_len">total_len</a></dd>

            </div>
            <div><dt>builtins.dict</dt>
                                <dd id="X4ReactionField.get" class="function">get</dd>
                <dd id="X4ReactionField.setdefault" class="function">setdefault</dd>
                <dd id="X4ReactionField.pop" class="function">pop</dd>
                <dd id="X4ReactionField.popitem" class="function">popitem</dd>
                <dd id="X4ReactionField.keys" class="function">keys</dd>
                <dd id="X4ReactionField.items" class="function">items</dd>
                <dd id="X4ReactionField.values" class="function">values</dd>
                <dd id="X4ReactionField.update" class="function">update</dd>
                <dd id="X4ReactionField.fromkeys" class="function">fromkeys</dd>
                <dd id="X4ReactionField.clear" class="function">clear</dd>
                <dd id="X4ReactionField.copy" class="function">copy</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="X4MonitorField">
                                <div class="attr class">
        <a class="headerlink" href="#X4MonitorField">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">X4MonitorField</span><wbr>(<span class="base"><a href="#X4ReactionField">X4ReactionField</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="X4MonitorField-259"><a href="#X4MonitorField-259"><span class="linenos">259</span></a><span class="k">class</span> <span class="nc">X4MonitorField</span><span class="p">(</span><span class="n">X4ReactionField</span><span class="p">):</span>
</span><span id="X4MonitorField-260"><a href="#X4MonitorField-260"><span class="linenos">260</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="X4MonitorField-261"><a href="#X4MonitorField-261"><span class="linenos">261</span></a><span class="sd">    Parsed Exfor Monitor Field</span>
</span><span id="X4MonitorField-262"><a href="#X4MonitorField-262"><span class="linenos">262</span></a>
</span><span id="X4MonitorField-263"><a href="#X4MonitorField-263"><span class="linenos">263</span></a><span class="sd">    The reaction monitors are stored in the ``reactions`` data member, just like an regular X4ReactionField.</span>
</span><span id="X4MonitorField-264"><a href="#X4MonitorField-264"><span class="linenos">264</span></a><span class="sd">    This is a Python dict who&#39;s keys are a reaction pointer (&#39; &#39; if there isn&#39;t one) and</span>
</span><span id="X4MonitorField-265"><a href="#X4MonitorField-265"><span class="linenos">265</span></a><span class="sd">    value are a list of all monitors for this reaction.  The elements of the list of</span>
</span><span id="X4MonitorField-266"><a href="#X4MonitorField-266"><span class="linenos">266</span></a><span class="sd">    monitors are a 3-tuple: ( X4Reaction, free text, DATA column reference ) ::</span>
</span><span id="X4MonitorField-267"><a href="#X4MonitorField-267"><span class="linenos">267</span></a>
</span><span id="X4MonitorField-268"><a href="#X4MonitorField-268"><span class="linenos">268</span></a><span class="sd">        - The X4Reaction, is the monitor reaction</span>
</span><span id="X4MonitorField-269"><a href="#X4MonitorField-269"><span class="linenos">269</span></a><span class="sd">        - The free text is free text entered by the EXFOR compiler</span>
</span><span id="X4MonitorField-270"><a href="#X4MonitorField-270"><span class="linenos">270</span></a><span class="sd">        - The DATA column reference is the column header of the monitor reaction data</span>
</span><span id="X4MonitorField-271"><a href="#X4MonitorField-271"><span class="linenos">271</span></a><span class="sd">          given in the DATA section of this EXFOR subentry.</span>
</span><span id="X4MonitorField-272"><a href="#X4MonitorField-272"><span class="linenos">272</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="X4MonitorField-273"><a href="#X4MonitorField-273"><span class="linenos">273</span></a>
</span><span id="X4MonitorField-274"><a href="#X4MonitorField-274"><span class="linenos">274</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="X4MonitorField-275"><a href="#X4MonitorField-275"><span class="linenos">275</span></a>        <span class="n">X4PlainField</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>  <span class="c1"># this should chop reaction field into separate measurements, 1/pointer</span>
</span><span id="X4MonitorField-276"><a href="#X4MonitorField-276"><span class="linenos">276</span></a>
</span><span id="X4MonitorField-277"><a href="#X4MonitorField-277"><span class="linenos">277</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="X4MonitorField-278"><a href="#X4MonitorField-278"><span class="linenos">278</span></a>
</span><span id="X4MonitorField-279"><a href="#X4MonitorField-279"><span class="linenos">279</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="X4MonitorField-280"><a href="#X4MonitorField-280"><span class="linenos">280</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4MonitorField-281"><a href="#X4MonitorField-281"><span class="linenos">281</span></a>
</span><span id="X4MonitorField-282"><a href="#X4MonitorField-282"><span class="linenos">282</span></a>            <span class="c1"># Chop field into reactions</span>
</span><span id="X4MonitorField-283"><a href="#X4MonitorField-283"><span class="linenos">283</span></a>            <span class="n">ds</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4MonitorField-284"><a href="#X4MonitorField-284"><span class="linenos">284</span></a>
</span><span id="X4MonitorField-285"><a href="#X4MonitorField-285"><span class="linenos">285</span></a>            <span class="n">lineQueue</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
</span><span id="X4MonitorField-286"><a href="#X4MonitorField-286"><span class="linenos">286</span></a>            <span class="k">while</span> <span class="n">lineQueue</span><span class="p">:</span>
</span><span id="X4MonitorField-287"><a href="#X4MonitorField-287"><span class="linenos">287</span></a>                <span class="n">line</span> <span class="o">=</span> <span class="n">lineQueue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="X4MonitorField-288"><a href="#X4MonitorField-288"><span class="linenos">288</span></a>
</span><span id="X4MonitorField-289"><a href="#X4MonitorField-289"><span class="linenos">289</span></a>                <span class="c1"># Case 1: ((MONIT#(REACTION)) style formatting -- may extend on several lines</span>
</span><span id="X4MonitorField-290"><a href="#X4MonitorField-290"><span class="linenos">290</span></a>                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;((&#39;</span><span class="p">):</span>
</span><span id="X4MonitorField-291"><a href="#X4MonitorField-291"><span class="linenos">291</span></a>                    <span class="n">ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="X4MonitorField-292"><a href="#X4MonitorField-292"><span class="linenos">292</span></a>                    <span class="k">if</span> <span class="n">ds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">):</span>
</span><span id="X4MonitorField-293"><a href="#X4MonitorField-293"><span class="linenos">293</span></a>                        <span class="n">ds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">lineQueue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="X4MonitorField-294"><a href="#X4MonitorField-294"><span class="linenos">294</span></a>
</span><span id="X4MonitorField-295"><a href="#X4MonitorField-295"><span class="linenos">295</span></a>                <span class="c1"># Case 2: (REACTION) style formatting -- may also extend on several lines</span>
</span><span id="X4MonitorField-296"><a href="#X4MonitorField-296"><span class="linenos">296</span></a>                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">):</span>
</span><span id="X4MonitorField-297"><a href="#X4MonitorField-297"><span class="linenos">297</span></a>                    <span class="n">ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="X4MonitorField-298"><a href="#X4MonitorField-298"><span class="linenos">298</span></a>                    <span class="k">if</span> <span class="n">ds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">):</span>
</span><span id="X4MonitorField-299"><a href="#X4MonitorField-299"><span class="linenos">299</span></a>                        <span class="n">ds</span> <span class="o">+=</span> <span class="n">lineQueue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="X4MonitorField-300"><a href="#X4MonitorField-300"><span class="linenos">300</span></a>
</span><span id="X4MonitorField-301"><a href="#X4MonitorField-301"><span class="linenos">301</span></a>                <span class="c1"># Case 3: Free Text -- may also extend on several lines, let the continuation logic catch this</span>
</span><span id="X4MonitorField-302"><a href="#X4MonitorField-302"><span class="linenos">302</span></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="X4MonitorField-303"><a href="#X4MonitorField-303"><span class="linenos">303</span></a>                    <span class="n">ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="X4MonitorField-304"><a href="#X4MonitorField-304"><span class="linenos">304</span></a>
</span><span id="X4MonitorField-305"><a href="#X4MonitorField-305"><span class="linenos">305</span></a>                <span class="c1"># A regular continuation line</span>
</span><span id="X4MonitorField-306"><a href="#X4MonitorField-306"><span class="linenos">306</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="X4MonitorField-307"><a href="#X4MonitorField-307"><span class="linenos">307</span></a>                    <span class="n">ds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="X4MonitorField-308"><a href="#X4MonitorField-308"><span class="linenos">308</span></a>
</span><span id="X4MonitorField-309"><a href="#X4MonitorField-309"><span class="linenos">309</span></a>            <span class="c1"># Process each reaction</span>
</span><span id="X4MonitorField-310"><a href="#X4MonitorField-310"><span class="linenos">310</span></a>            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
</span><span id="X4MonitorField-311"><a href="#X4MonitorField-311"><span class="linenos">311</span></a>                <span class="n">heading</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="X4MonitorField-312"><a href="#X4MonitorField-312"><span class="linenos">312</span></a>                <span class="k">if</span> <span class="s1">&#39;MONIT&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
</span><span id="X4MonitorField-313"><a href="#X4MonitorField-313"><span class="linenos">313</span></a>                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;((MONIT&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="X4MonitorField-314"><a href="#X4MonitorField-314"><span class="linenos">314</span></a>                        <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
</span><span id="X4MonitorField-315"><a href="#X4MonitorField-315"><span class="linenos">315</span></a>                        <span class="n">d</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="X4MonitorField-316"><a href="#X4MonitorField-316"><span class="linenos">316</span></a>                        <span class="n">heading</span> <span class="o">=</span> <span class="s2">&quot;MONIT&quot;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
</span><span id="X4MonitorField-317"><a href="#X4MonitorField-317"><span class="linenos">317</span></a>                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">):</span>
</span><span id="X4MonitorField-318"><a href="#X4MonitorField-318"><span class="linenos">318</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="X4MonitorField-319"><a href="#X4MonitorField-319"><span class="linenos">319</span></a>                        <span class="n">f</span> <span class="o">=</span> <span class="n">exfor_reactions</span><span class="o">.</span><span class="n">x4reactionfield</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span><span id="X4MonitorField-320"><a href="#X4MonitorField-320"><span class="linenos">320</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">getMeasurementType</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">heading</span><span class="p">))</span>
</span><span id="X4MonitorField-321"><a href="#X4MonitorField-321"><span class="linenos">321</span></a>                    <span class="k">except</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="X4MonitorField-322"><a href="#X4MonitorField-322"><span class="linenos">322</span></a>                        <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">ReactionParsingError</span><span class="p">(</span>
</span><span id="X4MonitorField-323"><a href="#X4MonitorField-323"><span class="linenos">323</span></a>                            <span class="s1">&#39;Can not parse reaction &quot;</span><span class="si">%s</span><span class="s1">&quot; (part of &quot;</span><span class="si">%s</span><span class="s1">&quot;),</span><span class="se">\n</span><span class="s1">    got error </span><span class="si">%s</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ds</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)))</span>
</span><span id="X4MonitorField-324"><a href="#X4MonitorField-324"><span class="linenos">324</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="X4MonitorField-325"><a href="#X4MonitorField-325"><span class="linenos">325</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">heading</span><span class="p">))</span>
</span><span id="X4MonitorField-326"><a href="#X4MonitorField-326"><span class="linenos">326</span></a>
</span><span id="X4MonitorField-327"><a href="#X4MonitorField-327"><span class="linenos">327</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="X4MonitorField-328"><a href="#X4MonitorField-328"><span class="linenos">328</span></a>        <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4MonitorField-329"><a href="#X4MonitorField-329"><span class="linenos">329</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="o">==</span> <span class="p">{}:</span> <span class="k">return</span> <span class="n">ans</span>
</span><span id="X4MonitorField-330"><a href="#X4MonitorField-330"><span class="linenos">330</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_keys</span><span class="p">:</span>
</span><span id="X4MonitorField-331"><a href="#X4MonitorField-331"><span class="linenos">331</span></a>            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
</span><span id="X4MonitorField-332"><a href="#X4MonitorField-332"><span class="linenos">332</span></a>                <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
</span><span id="X4MonitorField-333"><a href="#X4MonitorField-333"><span class="linenos">333</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="X4MonitorField-334"><a href="#X4MonitorField-334"><span class="linenos">334</span></a>                <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="s1">&#39;] &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
</span><span id="X4MonitorField-335"><a href="#X4MonitorField-335"><span class="linenos">335</span></a>        <span class="k">return</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Parsed Exfor Monitor Field</p>

<p>The reaction monitors are stored in the <code>reactions</code> data member, just like an regular X4ReactionField.
This is a Python dict who's keys are a reaction pointer (' ' if there isn't one) and
value are a list of all monitors for this reaction.  The elements of the list of
monitors are a 3-tuple: ( X4Reaction, free text, DATA column reference ) ::</p>

<pre><code>- The X4Reaction, is the monitor reaction
- The free text is free text entered by the EXFOR compiler
- The DATA column reference is the column header of the monitor reaction data
  given in the DATA section of this EXFOR subentry.
</code></pre>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#X4ReactionField">X4ReactionField</a></dt>
                                <dd id="X4MonitorField.getMeasurementType" class="function"><a href="#X4ReactionField.getMeasurementType">getMeasurementType</a></dd>
                <dd id="X4MonitorField.getEquation" class="function"><a href="#X4ReactionField.getEquation">getEquation</a></dd>
                <dd id="X4MonitorField.getX4ReactionList" class="function"><a href="#X4ReactionField.getX4ReactionList">getX4ReactionList</a></dd>

            </div>
            <div><dt><a href="#X4PlainField">X4PlainField</a></dt>
                                <dd id="X4MonitorField.total_len" class="function"><a href="#X4PlainField.total_len">total_len</a></dd>

            </div>
            <div><dt>builtins.dict</dt>
                                <dd id="X4MonitorField.get" class="function">get</dd>
                <dd id="X4MonitorField.setdefault" class="function">setdefault</dd>
                <dd id="X4MonitorField.pop" class="function">pop</dd>
                <dd id="X4MonitorField.popitem" class="function">popitem</dd>
                <dd id="X4MonitorField.keys" class="function">keys</dd>
                <dd id="X4MonitorField.items" class="function">items</dd>
                <dd id="X4MonitorField.values" class="function">values</dd>
                <dd id="X4MonitorField.update" class="function">update</dd>
                <dd id="X4MonitorField.fromkeys" class="function">fromkeys</dd>
                <dd id="X4MonitorField.clear" class="function">clear</dd>
                <dd id="X4MonitorField.copy" class="function">copy</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="X4ReferenceField">
                                <div class="attr class">
        <a class="headerlink" href="#X4ReferenceField">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">X4ReferenceField</span><wbr>(<span class="base"><a href="#X4PlainField">X4PlainField</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="X4ReferenceField-342"><a href="#X4ReferenceField-342"><span class="linenos">342</span></a><span class="k">class</span> <span class="nc">X4ReferenceField</span><span class="p">(</span><span class="n">X4PlainField</span><span class="p">):</span>
</span><span id="X4ReferenceField-343"><a href="#X4ReferenceField-343"><span class="linenos">343</span></a>    <span class="sd">&quot;&quot;&quot;Parsed EXFOR reference field&quot;&quot;&quot;</span>
</span><span id="X4ReferenceField-344"><a href="#X4ReferenceField-344"><span class="linenos">344</span></a>
</span><span id="X4ReferenceField-345"><a href="#X4ReferenceField-345"><span class="linenos">345</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="X4ReferenceField-346"><a href="#X4ReferenceField-346"><span class="linenos">346</span></a>        <span class="n">X4PlainField</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="X4ReferenceField-347"><a href="#X4ReferenceField-347"><span class="linenos">347</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="X4ReferenceField-348"><a href="#X4ReferenceField-348"><span class="linenos">348</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="X4ReferenceField-349"><a href="#X4ReferenceField-349"><span class="linenos">349</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="X4ReferenceField-350"><a href="#X4ReferenceField-350"><span class="linenos">350</span></a>                <span class="n">refs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4ReferenceField-351"><a href="#X4ReferenceField-351"><span class="linenos">351</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4ReferenceField-352"><a href="#X4ReferenceField-352"><span class="linenos">352</span></a>                <span class="n">intautology</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="X4ReferenceField-353"><a href="#X4ReferenceField-353"><span class="linenos">353</span></a>                <span class="n">hastautology</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="X4ReferenceField-354"><a href="#X4ReferenceField-354"><span class="linenos">354</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">]:</span>
</span><span id="X4ReferenceField-355"><a href="#X4ReferenceField-355"><span class="linenos">355</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;((&#39;</span><span class="p">:</span>
</span><span id="X4ReferenceField-356"><a href="#X4ReferenceField-356"><span class="linenos">356</span></a>                        <span class="n">intautology</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="X4ReferenceField-357"><a href="#X4ReferenceField-357"><span class="linenos">357</span></a>                        <span class="n">hastautology</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="X4ReferenceField-358"><a href="#X4ReferenceField-358"><span class="linenos">358</span></a>                        <span class="n">refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
</span><span id="X4ReferenceField-359"><a href="#X4ReferenceField-359"><span class="linenos">359</span></a>                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">intautology</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">:</span>
</span><span id="X4ReferenceField-360"><a href="#X4ReferenceField-360"><span class="linenos">360</span></a>                        <span class="n">refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
</span><span id="X4ReferenceField-361"><a href="#X4ReferenceField-361"><span class="linenos">361</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="X4ReferenceField-362"><a href="#X4ReferenceField-362"><span class="linenos">362</span></a>                        <span class="n">refs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="X4ReferenceField-363"><a href="#X4ReferenceField-363"><span class="linenos">363</span></a>                    <span class="k">if</span> <span class="s1">&#39;))&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="X4ReferenceField-364"><a href="#X4ReferenceField-364"><span class="linenos">364</span></a>                        <span class="n">intautology</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="X4ReferenceField-365"><a href="#X4ReferenceField-365"><span class="linenos">365</span></a>                <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">:</span>
</span><span id="X4ReferenceField-366"><a href="#X4ReferenceField-366"><span class="linenos">366</span></a>                    <span class="k">if</span> <span class="n">hastautology</span> <span class="ow">and</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">xx</span><span class="p">:</span>
</span><span id="X4ReferenceField-367"><a href="#X4ReferenceField-367"><span class="linenos">367</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="X4ReferenceField-368"><a href="#X4ReferenceField-368"><span class="linenos">368</span></a>                            <span class="n">xref</span> <span class="o">=</span> <span class="n">exfor_reference</span><span class="o">.</span><span class="n">x4refcodetautology</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span><span class="o">.</span><span class="n">asList</span><span class="p">()</span>
</span><span id="X4ReferenceField-369"><a href="#X4ReferenceField-369"><span class="linenos">369</span></a>                        <span class="k">except</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="X4ReferenceField-370"><a href="#X4ReferenceField-370"><span class="linenos">370</span></a>                            <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">ReferenceParsingError</span><span class="p">(</span>
</span><span id="X4ReferenceField-371"><a href="#X4ReferenceField-371"><span class="linenos">371</span></a>                                <span class="s1">&#39;Can not parse reference &quot;&#39;</span> <span class="o">+</span> <span class="n">xx</span> <span class="o">+</span> <span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">    got error &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">)</span>
</span><span id="X4ReferenceField-372"><a href="#X4ReferenceField-372"><span class="linenos">372</span></a>                        <span class="n">refcomment</span> <span class="o">=</span> <span class="n">xref</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="X4ReferenceField-373"><a href="#X4ReferenceField-373"><span class="linenos">373</span></a>                        <span class="k">for</span> <span class="n">xxx</span> <span class="ow">in</span> <span class="n">xref</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="X4ReferenceField-374"><a href="#X4ReferenceField-374"><span class="linenos">374</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="X4ReferenceField-375"><a href="#X4ReferenceField-375"><span class="linenos">375</span></a>                                <span class="k">if</span> <span class="n">xxx</span> <span class="o">!=</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span>
</span><span id="X4ReferenceField-376"><a href="#X4ReferenceField-376"><span class="linenos">376</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="X4ReferenceField-377"><a href="#X4ReferenceField-377"><span class="linenos">377</span></a>                                        <span class="p">(</span><span class="n">exfor_reference</span><span class="o">.</span><span class="n">X4ReferenceCode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">xxx</span><span class="p">)),</span> <span class="n">refcomment</span><span class="p">))</span>
</span><span id="X4ReferenceField-378"><a href="#X4ReferenceField-378"><span class="linenos">378</span></a>                            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span><span class="p">,</span> <span class="ne">LookupError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="X4ReferenceField-379"><a href="#X4ReferenceField-379"><span class="linenos">379</span></a>                                <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">ReferenceParsingError</span><span class="p">(</span>
</span><span id="X4ReferenceField-380"><a href="#X4ReferenceField-380"><span class="linenos">380</span></a>                                    <span class="s1">&#39;Can not parse reference &quot;&#39;</span> <span class="o">+</span> <span class="n">xx</span> <span class="o">+</span> <span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">    got error &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">)</span>
</span><span id="X4ReferenceField-381"><a href="#X4ReferenceField-381"><span class="linenos">381</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="X4ReferenceField-382"><a href="#X4ReferenceField-382"><span class="linenos">382</span></a>                        <span class="n">xref</span> <span class="o">=</span> <span class="n">exfor_reference</span><span class="o">.</span><span class="n">x4refcode</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span><span class="o">.</span><span class="n">asList</span><span class="p">()</span>
</span><span id="X4ReferenceField-383"><a href="#X4ReferenceField-383"><span class="linenos">383</span></a>                        <span class="n">refcomment</span> <span class="o">=</span> <span class="n">xref</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="X4ReferenceField-384"><a href="#X4ReferenceField-384"><span class="linenos">384</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="X4ReferenceField-385"><a href="#X4ReferenceField-385"><span class="linenos">385</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">exfor_reference</span><span class="o">.</span><span class="n">X4ReferenceCode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">xref</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">refcomment</span><span class="p">))</span>
</span><span id="X4ReferenceField-386"><a href="#X4ReferenceField-386"><span class="linenos">386</span></a>                        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span><span class="p">,</span> <span class="ne">LookupError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="X4ReferenceField-387"><a href="#X4ReferenceField-387"><span class="linenos">387</span></a>                            <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">ReferenceParsingError</span><span class="p">(</span>
</span><span id="X4ReferenceField-388"><a href="#X4ReferenceField-388"><span class="linenos">388</span></a>                                <span class="s1">&#39;Can not parse reference &quot;&#39;</span> <span class="o">+</span> <span class="n">xx</span> <span class="o">+</span> <span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">    got error &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">)</span>
</span><span id="X4ReferenceField-389"><a href="#X4ReferenceField-389"><span class="linenos">389</span></a>            <span class="c1"># Take this reference main info from first reference in field that we could parse</span>
</span><span id="X4ReferenceField-390"><a href="#X4ReferenceField-390"><span class="linenos">390</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">:</span>
</span><span id="X4ReferenceField-391"><a href="#X4ReferenceField-391"><span class="linenos">391</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">exfor_reference</span><span class="o">.</span><span class="n">X4ReferenceCode</span><span class="p">):</span>
</span><span id="X4ReferenceField-392"><a href="#X4ReferenceField-392"><span class="linenos">392</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">reftype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reftype</span>
</span><span id="X4ReferenceField-393"><a href="#X4ReferenceField-393"><span class="linenos">393</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
</span><span id="X4ReferenceField-394"><a href="#X4ReferenceField-394"><span class="linenos">394</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">details</span>
</span><span id="X4ReferenceField-395"><a href="#X4ReferenceField-395"><span class="linenos">395</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span>
</span><span id="X4ReferenceField-396"><a href="#X4ReferenceField-396"><span class="linenos">396</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pubyear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pubyear</span>
</span><span id="X4ReferenceField-397"><a href="#X4ReferenceField-397"><span class="linenos">397</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pubtype</span> <span class="o">=</span> <span class="n">pubTypeMap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reftype</span><span class="p">]</span>
</span><span id="X4ReferenceField-398"><a href="#X4ReferenceField-398"><span class="linenos">398</span></a>                    <span class="k">break</span>
</span><span id="X4ReferenceField-399"><a href="#X4ReferenceField-399"><span class="linenos">399</span></a>        <span class="k">except</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">ReferenceParsingError</span><span class="p">:</span>
</span><span id="X4ReferenceField-400"><a href="#X4ReferenceField-400"><span class="linenos">400</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reftype</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
</span><span id="X4ReferenceField-401"><a href="#X4ReferenceField-401"><span class="linenos">401</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Parsing failed&#39;</span>
</span><span id="X4ReferenceField-402"><a href="#X4ReferenceField-402"><span class="linenos">402</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">details</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
</span><span id="X4ReferenceField-403"><a href="#X4ReferenceField-403"><span class="linenos">403</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
</span><span id="X4ReferenceField-404"><a href="#X4ReferenceField-404"><span class="linenos">404</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pubyear</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
</span><span id="X4ReferenceField-405"><a href="#X4ReferenceField-405"><span class="linenos">405</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pubtype</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
</span><span id="X4ReferenceField-406"><a href="#X4ReferenceField-406"><span class="linenos">406</span></a>
</span><span id="X4ReferenceField-407"><a href="#X4ReferenceField-407"><span class="linenos">407</span></a>    <span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
</span><span id="X4ReferenceField-408"><a href="#X4ReferenceField-408"><span class="linenos">408</span></a>        <span class="sd">&quot;&quot;&quot;flattens nested parens in volume part of a reference&quot;&quot;&quot;</span>
</span><span id="X4ReferenceField-409"><a href="#X4ReferenceField-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="X4ReferenceField-410"><a href="#X4ReferenceField-410"><span class="linenos">410</span></a>            <span class="k">return</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="X4ReferenceField-411"><a href="#X4ReferenceField-411"><span class="linenos">411</span></a>
</span><span id="X4ReferenceField-412"><a href="#X4ReferenceField-412"><span class="linenos">412</span></a>        <span class="k">def</span> <span class="nf">parens</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="X4ReferenceField-413"><a href="#X4ReferenceField-413"><span class="linenos">413</span></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="X4ReferenceField-414"><a href="#X4ReferenceField-414"><span class="linenos">414</span></a>                <span class="k">return</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
</span><span id="X4ReferenceField-415"><a href="#X4ReferenceField-415"><span class="linenos">415</span></a>            <span class="k">return</span> <span class="n">x</span>
</span><span id="X4ReferenceField-416"><a href="#X4ReferenceField-416"><span class="linenos">416</span></a>
</span><span id="X4ReferenceField-417"><a href="#X4ReferenceField-417"><span class="linenos">417</span></a>        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">parens</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span>
</span><span id="X4ReferenceField-418"><a href="#X4ReferenceField-418"><span class="linenos">418</span></a>
</span><span id="X4ReferenceField-419"><a href="#X4ReferenceField-419"><span class="linenos">419</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="X4ReferenceField-420"><a href="#X4ReferenceField-420"><span class="linenos">420</span></a>        <span class="sd">&quot;&quot;&quot;Pretty version of field&quot;&quot;&quot;</span>
</span><span id="X4ReferenceField-421"><a href="#X4ReferenceField-421"><span class="linenos">421</span></a>        <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4ReferenceField-422"><a href="#X4ReferenceField-422"><span class="linenos">422</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">:</span>
</span><span id="X4ReferenceField-423"><a href="#X4ReferenceField-423"><span class="linenos">423</span></a>            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
</span><span id="X4ReferenceField-424"><a href="#X4ReferenceField-424"><span class="linenos">424</span></a>                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="X4ReferenceField-425"><a href="#X4ReferenceField-425"><span class="linenos">425</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="X4ReferenceField-426"><a href="#X4ReferenceField-426"><span class="linenos">426</span></a>                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
</span><span id="X4ReferenceField-427"><a href="#X4ReferenceField-427"><span class="linenos">427</span></a>            <span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">p</span><span class="p">]])</span>
</span><span id="X4ReferenceField-428"><a href="#X4ReferenceField-428"><span class="linenos">428</span></a>        <span class="k">return</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Parsed EXFOR reference field</p>
</div>


                            <div id="X4ReferenceField.flatten" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#X4ReferenceField.flatten">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">flatten</span><span class="signature">(self, l)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="X4ReferenceField.flatten-407"><a href="#X4ReferenceField.flatten-407"><span class="linenos">407</span></a>    <span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
</span><span id="X4ReferenceField.flatten-408"><a href="#X4ReferenceField.flatten-408"><span class="linenos">408</span></a>        <span class="sd">&quot;&quot;&quot;flattens nested parens in volume part of a reference&quot;&quot;&quot;</span>
</span><span id="X4ReferenceField.flatten-409"><a href="#X4ReferenceField.flatten-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="X4ReferenceField.flatten-410"><a href="#X4ReferenceField.flatten-410"><span class="linenos">410</span></a>            <span class="k">return</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="X4ReferenceField.flatten-411"><a href="#X4ReferenceField.flatten-411"><span class="linenos">411</span></a>
</span><span id="X4ReferenceField.flatten-412"><a href="#X4ReferenceField.flatten-412"><span class="linenos">412</span></a>        <span class="k">def</span> <span class="nf">parens</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="X4ReferenceField.flatten-413"><a href="#X4ReferenceField.flatten-413"><span class="linenos">413</span></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="X4ReferenceField.flatten-414"><a href="#X4ReferenceField.flatten-414"><span class="linenos">414</span></a>                <span class="k">return</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
</span><span id="X4ReferenceField.flatten-415"><a href="#X4ReferenceField.flatten-415"><span class="linenos">415</span></a>            <span class="k">return</span> <span class="n">x</span>
</span><span id="X4ReferenceField.flatten-416"><a href="#X4ReferenceField.flatten-416"><span class="linenos">416</span></a>
</span><span id="X4ReferenceField.flatten-417"><a href="#X4ReferenceField.flatten-417"><span class="linenos">417</span></a>        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">parens</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>flattens nested parens in volume part of a reference</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#X4PlainField">X4PlainField</a></dt>
                                <dd id="X4ReferenceField.total_len" class="function"><a href="#X4PlainField.total_len">total_len</a></dd>

            </div>
            <div><dt>builtins.dict</dt>
                                <dd id="X4ReferenceField.get" class="function">get</dd>
                <dd id="X4ReferenceField.setdefault" class="function">setdefault</dd>
                <dd id="X4ReferenceField.pop" class="function">pop</dd>
                <dd id="X4ReferenceField.popitem" class="function">popitem</dd>
                <dd id="X4ReferenceField.keys" class="function">keys</dd>
                <dd id="X4ReferenceField.items" class="function">items</dd>
                <dd id="X4ReferenceField.values" class="function">values</dd>
                <dd id="X4ReferenceField.update" class="function">update</dd>
                <dd id="X4ReferenceField.fromkeys" class="function">fromkeys</dd>
                <dd id="X4ReferenceField.clear" class="function">clear</dd>
                <dd id="X4ReferenceField.copy" class="function">copy</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="X4TitleField">
                                <div class="attr class">
        <a class="headerlink" href="#X4TitleField">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">X4TitleField</span><wbr>(<span class="base"><a href="#X4PlainField">X4PlainField</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="X4TitleField-431"><a href="#X4TitleField-431"><span class="linenos">431</span></a><span class="k">class</span> <span class="nc">X4TitleField</span><span class="p">(</span><span class="n">X4PlainField</span><span class="p">):</span>
</span><span id="X4TitleField-432"><a href="#X4TitleField-432"><span class="linenos">432</span></a>    <span class="sd">&quot;&quot;&quot;Cleaned up title&quot;&quot;&quot;</span>
</span><span id="X4TitleField-433"><a href="#X4TitleField-433"><span class="linenos">433</span></a>
</span><span id="X4TitleField-434"><a href="#X4TitleField-434"><span class="linenos">434</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="X4TitleField-435"><a href="#X4TitleField-435"><span class="linenos">435</span></a>        <span class="n">X4PlainField</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="X4TitleField-436"><a href="#X4TitleField-436"><span class="linenos">436</span></a>
</span><span id="X4TitleField-437"><a href="#X4TitleField-437"><span class="linenos">437</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="X4TitleField-438"><a href="#X4TitleField-438"><span class="linenos">438</span></a>        <span class="sd">&#39;&#39;&#39;Pretty version of field&#39;&#39;&#39;</span>
</span><span id="X4TitleField-439"><a href="#X4TitleField-439"><span class="linenos">439</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4TitleField-440"><a href="#X4TitleField-440"><span class="linenos">440</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_keys</span><span class="p">:</span>
</span><span id="X4TitleField-441"><a href="#X4TitleField-441"><span class="linenos">441</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">])</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="X4TitleField-442"><a href="#X4TitleField-442"><span class="linenos">442</span></a>        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Cleaned up title</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#X4PlainField">X4PlainField</a></dt>
                                <dd id="X4TitleField.total_len" class="function"><a href="#X4PlainField.total_len">total_len</a></dd>

            </div>
            <div><dt>builtins.dict</dt>
                                <dd id="X4TitleField.get" class="function">get</dd>
                <dd id="X4TitleField.setdefault" class="function">setdefault</dd>
                <dd id="X4TitleField.pop" class="function">pop</dd>
                <dd id="X4TitleField.popitem" class="function">popitem</dd>
                <dd id="X4TitleField.keys" class="function">keys</dd>
                <dd id="X4TitleField.items" class="function">items</dd>
                <dd id="X4TitleField.values" class="function">values</dd>
                <dd id="X4TitleField.update" class="function">update</dd>
                <dd id="X4TitleField.fromkeys" class="function">fromkeys</dd>
                <dd id="X4TitleField.clear" class="function">clear</dd>
                <dd id="X4TitleField.copy" class="function">copy</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="X4AuthorField">
                                <div class="attr class">
        <a class="headerlink" href="#X4AuthorField">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">X4AuthorField</span><wbr>(<span class="base"><a href="#X4PlainField">X4PlainField</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="X4AuthorField-445"><a href="#X4AuthorField-445"><span class="linenos">445</span></a><span class="k">class</span> <span class="nc">X4AuthorField</span><span class="p">(</span><span class="n">X4PlainField</span><span class="p">):</span>
</span><span id="X4AuthorField-446"><a href="#X4AuthorField-446"><span class="linenos">446</span></a>    <span class="sd">&quot;&quot;&quot;Cleaned up author list&quot;&quot;&quot;</span>
</span><span id="X4AuthorField-447"><a href="#X4AuthorField-447"><span class="linenos">447</span></a>
</span><span id="X4AuthorField-448"><a href="#X4AuthorField-448"><span class="linenos">448</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="X4AuthorField-449"><a href="#X4AuthorField-449"><span class="linenos">449</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">authors</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4AuthorField-450"><a href="#X4AuthorField-450"><span class="linenos">450</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">extraData</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="X4AuthorField-451"><a href="#X4AuthorField-451"><span class="linenos">451</span></a>        <span class="k">for</span> <span class="n">noAuthorString</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;No author given&quot;</span><span class="p">,</span> <span class="s2">&quot;.NOT GIVEN.&quot;</span><span class="p">,</span> <span class="s2">&quot;Not given&quot;</span><span class="p">]:</span>
</span><span id="X4AuthorField-452"><a href="#X4AuthorField-452"><span class="linenos">452</span></a>            <span class="k">if</span> <span class="n">noAuthorString</span> <span class="ow">in</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="X4AuthorField-453"><a href="#X4AuthorField-453"><span class="linenos">453</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">author_family_names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4AuthorField-454"><a href="#X4AuthorField-454"><span class="linenos">454</span></a>                <span class="k">return</span>
</span><span id="X4AuthorField-455"><a href="#X4AuthorField-455"><span class="linenos">455</span></a>        <span class="n">X4PlainField</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="X4AuthorField-456"><a href="#X4AuthorField-456"><span class="linenos">456</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="X4AuthorField-457"><a href="#X4AuthorField-457"><span class="linenos">457</span></a>            <span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">]])</span>
</span><span id="X4AuthorField-458"><a href="#X4AuthorField-458"><span class="linenos">458</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="X4AuthorField-459"><a href="#X4AuthorField-459"><span class="linenos">459</span></a>                <span class="n">tt</span> <span class="o">=</span> <span class="n">exfor_grammars</span><span class="o">.</span><span class="n">x4refcode</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">asList</span><span class="p">()</span>
</span><span id="X4AuthorField-460"><a href="#X4AuthorField-460"><span class="linenos">460</span></a>            <span class="k">except</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="X4AuthorField-461"><a href="#X4AuthorField-461"><span class="linenos">461</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="X4AuthorField-462"><a href="#X4AuthorField-462"><span class="linenos">462</span></a>                    <span class="n">tt</span> <span class="o">=</span> <span class="n">exfor_grammars</span><span class="o">.</span><span class="n">x4refcode</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">asList</span><span class="p">()</span>
</span><span id="X4AuthorField-463"><a href="#X4AuthorField-463"><span class="linenos">463</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="X4AuthorField-464"><a href="#X4AuthorField-464"><span class="linenos">464</span></a>                    <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">AuthorParsingError</span><span class="p">(</span>
</span><span id="X4AuthorField-465"><a href="#X4AuthorField-465"><span class="linenos">465</span></a>                        <span class="s1">&#39;Can not parse authors &quot;&#39;</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">    got error &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="X4AuthorField-466"><a href="#X4AuthorField-466"><span class="linenos">466</span></a>                            <span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot; when parsing as x4refcode</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">)</span>
</span><span id="X4AuthorField-467"><a href="#X4AuthorField-467"><span class="linenos">467</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="X4AuthorField-468"><a href="#X4AuthorField-468"><span class="linenos">468</span></a>                <span class="n">ttt</span> <span class="o">=</span> <span class="n">exfor_grammars</span><span class="o">.</span><span class="n">x4authorlist</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">asList</span><span class="p">()</span>
</span><span id="X4AuthorField-469"><a href="#X4AuthorField-469"><span class="linenos">469</span></a>            <span class="k">except</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="X4AuthorField-470"><a href="#X4AuthorField-470"><span class="linenos">470</span></a>                <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">AuthorParsingError</span><span class="p">(</span><span class="s1">&#39;Can not parse authors &quot;&#39;</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">    got error &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="X4AuthorField-471"><a href="#X4AuthorField-471"><span class="linenos">471</span></a>                    <span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot; when parsing as x4authorlist</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">)</span>
</span><span id="X4AuthorField-472"><a href="#X4AuthorField-472"><span class="linenos">472</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">authors</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ttt</span><span class="p">]</span>
</span><span id="X4AuthorField-473"><a href="#X4AuthorField-473"><span class="linenos">473</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">author_family_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">authors</span><span class="p">]</span>
</span><span id="X4AuthorField-474"><a href="#X4AuthorField-474"><span class="linenos">474</span></a>
</span><span id="X4AuthorField-475"><a href="#X4AuthorField-475"><span class="linenos">475</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="X4AuthorField-476"><a href="#X4AuthorField-476"><span class="linenos">476</span></a>        <span class="sd">&quot;&quot;&quot;Pretty version of field&quot;&quot;&quot;</span>
</span><span id="X4AuthorField-477"><a href="#X4AuthorField-477"><span class="linenos">477</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">authors</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="X4AuthorField-478"><a href="#X4AuthorField-478"><span class="linenos">478</span></a>            <span class="k">return</span> <span class="s2">&quot;No author given&quot;</span>
</span><span id="X4AuthorField-479"><a href="#X4AuthorField-479"><span class="linenos">479</span></a>        <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">authors</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Cleaned up author list</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#X4PlainField">X4PlainField</a></dt>
                                <dd id="X4AuthorField.total_len" class="function"><a href="#X4PlainField.total_len">total_len</a></dd>

            </div>
            <div><dt>builtins.dict</dt>
                                <dd id="X4AuthorField.get" class="function">get</dd>
                <dd id="X4AuthorField.setdefault" class="function">setdefault</dd>
                <dd id="X4AuthorField.pop" class="function">pop</dd>
                <dd id="X4AuthorField.popitem" class="function">popitem</dd>
                <dd id="X4AuthorField.keys" class="function">keys</dd>
                <dd id="X4AuthorField.items" class="function">items</dd>
                <dd id="X4AuthorField.values" class="function">values</dd>
                <dd id="X4AuthorField.update" class="function">update</dd>
                <dd id="X4AuthorField.fromkeys" class="function">fromkeys</dd>
                <dd id="X4AuthorField.clear" class="function">clear</dd>
                <dd id="X4AuthorField.copy" class="function">copy</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="X4InstituteField">
                                <div class="attr class">
        <a class="headerlink" href="#X4InstituteField">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">X4InstituteField</span><wbr>(<span class="base"><a href="#X4PlainField">X4PlainField</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="X4InstituteField-482"><a href="#X4InstituteField-482"><span class="linenos">482</span></a><span class="k">class</span> <span class="nc">X4InstituteField</span><span class="p">(</span><span class="n">X4PlainField</span><span class="p">):</span>
</span><span id="X4InstituteField-483"><a href="#X4InstituteField-483"><span class="linenos">483</span></a>    <span class="sd">&quot;&quot;&quot;Cleaned up institutes list&quot;&quot;&quot;</span>
</span><span id="X4InstituteField-484"><a href="#X4InstituteField-484"><span class="linenos">484</span></a>
</span><span id="X4InstituteField-485"><a href="#X4InstituteField-485"><span class="linenos">485</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="X4InstituteField-486"><a href="#X4InstituteField-486"><span class="linenos">486</span></a>        <span class="n">X4PlainField</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="X4InstituteField-487"><a href="#X4InstituteField-487"><span class="linenos">487</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">exfor_institutes_dictionary</span> <span class="o">=</span> <span class="n">exfor_dicts</span><span class="o">.</span><span class="n">X4DictionaryServer</span><span class="p">()[</span><span class="s1">&#39;Institutes&#39;</span><span class="p">]</span>
</span><span id="X4InstituteField-488"><a href="#X4InstituteField-488"><span class="linenos">488</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">institutes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4InstituteField-489"><a href="#X4InstituteField-489"><span class="linenos">489</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="X4InstituteField-490"><a href="#X4InstituteField-490"><span class="linenos">490</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="X4InstituteField-491"><a href="#X4InstituteField-491"><span class="linenos">491</span></a>                <span class="n">il</span> <span class="o">=</span> <span class="n">exfor_grammars</span><span class="o">.</span><span class="n">x4textfield</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">]))</span><span class="o">.</span><span class="n">asList</span><span class="p">()</span>
</span><span id="X4InstituteField-492"><a href="#X4InstituteField-492"><span class="linenos">492</span></a>            <span class="k">except</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="X4InstituteField-493"><a href="#X4InstituteField-493"><span class="linenos">493</span></a>                <span class="k">raise</span> <span class="n">exfor_exceptions</span><span class="o">.</span><span class="n">InstituteParsingError</span><span class="p">(</span>
</span><span id="X4InstituteField-494"><a href="#X4InstituteField-494"><span class="linenos">494</span></a>                    <span class="s1">&#39;Can not parse institute &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">    got error &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">)</span>
</span><span id="X4InstituteField-495"><a href="#X4InstituteField-495"><span class="linenos">495</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">il</span><span class="p">:</span>
</span><span id="X4InstituteField-496"><a href="#X4InstituteField-496"><span class="linenos">496</span></a>                <span class="n">tok</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="X4InstituteField-497"><a href="#X4InstituteField-497"><span class="linenos">497</span></a>                <span class="n">comment</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
</span><span id="X4InstituteField-498"><a href="#X4InstituteField-498"><span class="linenos">498</span></a>                <span class="k">if</span> <span class="n">tok</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exfor_institutes_dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="X4InstituteField-499"><a href="#X4InstituteField-499"><span class="linenos">499</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">institutes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tok</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exfor_institutes_dictionary</span><span class="p">[</span><span class="n">tok</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]][</span><span class="mi">0</span><span class="p">],</span> <span class="n">comment</span><span class="p">))</span>
</span><span id="X4InstituteField-500"><a href="#X4InstituteField-500"><span class="linenos">500</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="X4InstituteField-501"><a href="#X4InstituteField-501"><span class="linenos">501</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">institutes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tok</span><span class="p">,</span> <span class="n">tok</span><span class="p">,</span> <span class="n">comment</span><span class="p">))</span>
</span><span id="X4InstituteField-502"><a href="#X4InstituteField-502"><span class="linenos">502</span></a>
</span><span id="X4InstituteField-503"><a href="#X4InstituteField-503"><span class="linenos">503</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="X4InstituteField-504"><a href="#X4InstituteField-504"><span class="linenos">504</span></a>        <span class="sd">&quot;&quot;&quot;Pretty version of field&quot;&quot;&quot;</span>
</span><span id="X4InstituteField-505"><a href="#X4InstituteField-505"><span class="linenos">505</span></a>        <span class="n">inst</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="X4InstituteField-506"><a href="#X4InstituteField-506"><span class="linenos">506</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">institutes</span><span class="p">:</span>
</span><span id="X4InstituteField-507"><a href="#X4InstituteField-507"><span class="linenos">507</span></a>            <span class="n">entry</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="X4InstituteField-508"><a href="#X4InstituteField-508"><span class="linenos">508</span></a>            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">entry</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
</span><span id="X4InstituteField-509"><a href="#X4InstituteField-509"><span class="linenos">509</span></a>            <span class="n">inst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="X4InstituteField-510"><a href="#X4InstituteField-510"><span class="linenos">510</span></a>        <span class="k">return</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Cleaned up institutes list</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#X4PlainField">X4PlainField</a></dt>
                                <dd id="X4InstituteField.total_len" class="function"><a href="#X4PlainField.total_len">total_len</a></dd>

            </div>
            <div><dt>builtins.dict</dt>
                                <dd id="X4InstituteField.get" class="function">get</dd>
                <dd id="X4InstituteField.setdefault" class="function">setdefault</dd>
                <dd id="X4InstituteField.pop" class="function">pop</dd>
                <dd id="X4InstituteField.popitem" class="function">popitem</dd>
                <dd id="X4InstituteField.keys" class="function">keys</dd>
                <dd id="X4InstituteField.items" class="function">items</dd>
                <dd id="X4InstituteField.values" class="function">values</dd>
                <dd id="X4InstituteField.update" class="function">update</dd>
                <dd id="X4InstituteField.fromkeys" class="function">fromkeys</dd>
                <dd id="X4InstituteField.clear" class="function">clear</dd>
                <dd id="X4InstituteField.copy" class="function">copy</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>